USE WAREHOUSE PIPE_XLARGE;
USE SCHEMA SCRATCH.ROBINPATEL;

TRUNCATE SNOWPLOW_SAMPLE_EVENTS;

INSERT INTO SNOWPLOW_SAMPLE_EVENTS
SELECT APP_ID,
       PLATFORM,
       ETL_TSTAMP,
       COLLECTOR_TSTAMP,
       DVCE_CREATED_TSTAMP,
       EVENT,
       EVENT_ID,
       TXN_ID,
       NAME_TRACKER,
       V_TRACKER,
       V_COLLECTOR,
       V_ETL,
       USER_ID,
       USER_IPADDRESS,
       USER_FINGERPRINT,
       DOMAIN_USERID,
       DOMAIN_SESSIONIDX,
       NETWORK_USERID,
       GEO_COUNTRY,
       GEO_REGION,
       GEO_CITY,
       GEO_ZIPCODE,
       GEO_LATITUDE,
       GEO_LONGITUDE,
       GEO_REGION_NAME,
       IP_ISP,
       IP_ORGANIZATION,
       IP_DOMAIN,
       IP_NETSPEED,
       PAGE_URL,
       PAGE_TITLE,
       PAGE_REFERRER,
       PAGE_URLSCHEME,
       PAGE_URLHOST,
       PAGE_URLPORT,
       PAGE_URLPATH,
       PAGE_URLQUERY,
       PAGE_URLFRAGMENT,
       REFR_URLSCHEME,
       REFR_URLHOST,
       REFR_URLPORT,
       REFR_URLPATH,
       REFR_URLQUERY,
       REFR_URLFRAGMENT,
       REFR_MEDIUM,
       REFR_SOURCE,
       REFR_TERM,
       MKT_MEDIUM,
       MKT_SOURCE,
       MKT_TERM,
       MKT_CONTENT,
       MKT_CAMPAIGN,
       SE_CATEGORY,
       SE_ACTION,
       SE_LABEL,
       SE_PROPERTY,
       SE_VALUE,
       TR_ORDERID,
       TR_AFFILIATION,
       TR_TOTAL,
       TR_TAX,
       TR_SHIPPING,
       TR_CITY,
       TR_STATE,
       TR_COUNTRY,
       TI_ORDERID,
       TI_SKU,
       TI_NAME,
       TI_CATEGORY,
       TI_PRICE,
       TI_QUANTITY,
       PP_XOFFSET_MIN,
       PP_XOFFSET_MAX,
       PP_YOFFSET_MIN,
       PP_YOFFSET_MAX,
       USERAGENT,
       BR_NAME,
       BR_FAMILY,
       BR_VERSION,
       BR_TYPE,
       BR_RENDERENGINE,
       BR_LANG,
       BR_FEATURES_PDF,
       BR_FEATURES_FLASH,
       BR_FEATURES_JAVA,
       BR_FEATURES_DIRECTOR,
       BR_FEATURES_QUICKTIME,
       BR_FEATURES_REALPLAYER,
       BR_FEATURES_WINDOWSMEDIA,
       BR_FEATURES_GEARS,
       BR_FEATURES_SILVERLIGHT,
       BR_COOKIES,
       BR_COLORDEPTH,
       BR_VIEWWIDTH,
       BR_VIEWHEIGHT,
       OS_NAME,
       OS_FAMILY,
       OS_MANUFACTURER,
       OS_TIMEZONE,
       DVCE_TYPE,
       DVCE_ISMOBILE,
       DVCE_SCREENWIDTH,
       DVCE_SCREENHEIGHT,
       DOC_CHARSET,
       DOC_WIDTH,
       DOC_HEIGHT,
       TR_CURRENCY,
       TR_TOTAL_BASE,
       TR_TAX_BASE,
       TR_SHIPPING_BASE,
       TI_CURRENCY,
       TI_PRICE_BASE,
       BASE_CURRENCY,
       GEO_TIMEZONE,
       MKT_CLICKID,
       MKT_NETWORK,
       ETL_TAGS,
       DVCE_SENT_TSTAMP,
       REFR_DOMAIN_USERID,
       REFR_DVCE_TSTAMP,
       DOMAIN_SESSIONID,
       DERIVED_TSTAMP,
       EVENT_VENDOR,
       EVENT_NAME,
       EVENT_FORMAT,
       EVENT_VERSION,
       EVENT_FINGERPRINT,
       TRUE_TSTAMP,
       CONTEXTS_COM_OPTIMIZELY_SNOWPLOW_OPTIMIZELY_SUMMARY_1,
       CONTEXTS_COM_SECRETESCAPES_ALL_PAGES_SESSION_LOGIN_TYPE_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_SALE_PAGE_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1,
       CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_UA_PARSER_CONTEXT_1,
       CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_WEB_PAGE_1,
       CONTEXTS_ORG_W3_PERFORMANCE_TIMING_1,
       UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_SNOWPLOW_LINK_CLICK_1,
       CONTEXTS_COM_OPTIMIZELY_OPTIMIZELYX_SUMMARY_1,
       CONTEXTS_COM_SECRETESCAPES_COLLECTION_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_FILTER_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_SCREEN_CONTEXT_1,
       CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_APPLICATION_BACKGROUND_1,
       CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_APPLICATION_FOREGROUND_1,
       CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_CLIENT_SESSION_1,
       CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_MOBILE_CONTEXT_1,
       UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_SNOWPLOW_SCREEN_VIEW_1,
       UNSTRUCT_EVENT_COM_SECRETESCAPES_SEARCHED_WITH_REFINEMENT_EVENT_1,
       CONTEXTS_COM_OPTIMIZELY_EXPERIMENT_1,
       CONTEXTS_COM_OPTIMIZELY_STATE_1,
       CONTEXTS_COM_OPTIMIZELY_VARIATION_1,
       CONTEXTS_COM_OPTIMIZELY_VISITOR_1,
       CONTEXTS_COM_OPTIMIZELY_VISITOR_AUDIENCE_1,
       CONTEXTS_COM_OPTIMIZELY_VISITOR_DIMENSION_1,
       UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_MOBILE_SCREEN_VIEW_1,
       CONTEXTS_COM_SECRETESCAPES_BOOKING_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_CONTENT_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_ENVIRONMENT_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_SECRET_ESCAPES_SALE_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_USER_CONTEXT_1,
       CONTEXTS_COM_SECRETESCAPES_WHO_PUTS_PRODUCT_IN_FRONT_CUSTOMER_CONTEXT_1,
       UNSTRUCT_EVENT_COM_SECRETESCAPES_BOOKING_UPDATE_EVENT_1
FROM SNOWPLOW.ATOMIC.EVENTS
-- WHERE ETL_TSTAMP::DATE >= '2019-07-01'
--   AND ETL_TSTAMP::DATE < '2019-12-11';
--     WHERE ETL_TSTAMP > (SELECT MAX(ETL_TSTAMP) FROM SNOWPLOW_SAMPLE_EVENTS)
WHERE ETL_TSTAMP::DATE = '2019-12-11'
--   AND ETL_TSTAMP::DATE <= '2019-05-31';
;

------------------------------------------------------------------------------------------------------------------------

SELECT *
FROM SNOWPLOW.ATOMIC.EVENTS
WHERE ETL_TSTAMP = '2019-11-18 06:15:50.203000000';


-- 2019-11-19 16:15:50.179000000 Earliest tstamp of ss events
-- 2019-11-18 06:15:50.203000000 Earliest tstamp of when atomic event structure was changed

------------------------------------------------------------------------------------------------------------------------
TRUNCATE EVENT_STREAM;

INSERT into EVENT_STREAM
SELECT
--event hash
SHA2(
            COALESCE(EVENT_ID, '') ||
            COALESCE(EVENT_FINGERPRINT, '') ||
            COALESCE(COLLECTOR_TSTAMP, '1970-01-01 00:00:00') || --coalesce to a tstamp incase of null to avoid errors
            COALESCE(DERIVED_TSTAMP, '1970-01-01 00:00:00') ||
            COALESCE(USER_IPADDRESS, '') ||
            COALESCE(DVCE_SENT_TSTAMP, '1970-01-01 00:00:00')
    )                                                                                               AS event_hash,
--event user identifier
COALESCE(
        DOMAIN_USERID,
        CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_CLIENT_SESSION_1[0]['userId']::varchar,
        CONTEXTS_COM_SECRETESCAPES_USER_CONTEXT_1[0]['email_address']::varchar)
                                                                                                    AS identity_fragment,

--user id

TRY_TO_NUMBER(USER_ID)                                                                              AS se_user_id,


--robot spider
CASE
    WHEN BR_FAMILY = 'Robot/Spider'
        OR
         USERAGENT REGEXP
         '.*(bot|crawl|slurp|spider|archiv|spinn|sniff|seo|audit|survey|pingdom|worm|capture|(browser|screen)shots|analyz|index|thumb|check|facebook|PingdomBot|PhantomJS|YandexBot|Twitterbot|a_archiver|facebookexternalhit|Bingbot|BingPreview|Googlebot|Baiduspider|360(Spider|User-agent)|semalt).*'
        THEN TRUE
    ELSE FALSE END                                                                                  AS is_robot_spider_event,

--single tstamp
CASE
    WHEN DERIVED_TSTAMP > COLLECTOR_TSTAMP THEN COLLECTOR_TSTAMP
    --to correct for when the derived time is set in the future
    WHEN APP_ID LIKE 'ios_app%' AND DVCE_SENT_TSTAMP <= COLLECTOR_TSTAMP THEN DVCE_SENT_TSTAMP
    -- to correct for incorrect dvce_created_tstamp on all native app events
    WHEN DATEDIFF(day, DERIVED_TSTAMP, COLLECTOR_TSTAMP) > 1 AND DVCE_SENT_TSTAMP <= COLLECTOR_TSTAMP
        THEN DVCE_SENT_TSTAMP
    --to correct occurrences of the derived tstamp being so out due to the dvce created and dvce sent tstamp being so disparate
    WHEN DATEDIFF(day, DERIVED_TSTAMP, COLLECTOR_TSTAMP) > 1 AND DVCE_SENT_TSTAMP > COLLECTOR_TSTAMP
        THEN COLLECTOR_TSTAMP
    --to correct occurrences of the derived tstamp being so out due to the dvce created and dvce sent tstamp being so disparate AND dvce tstamps being in the future
    ELSE DERIVED_TSTAMP
    END                                                                                             as event_tstamp,

--territory
regexp_replace(APP_ID, 'ios_app ')                                                                  as posa_territory,

--device platform
CASE
    WHEN APP_ID LIKE 'ios_app%'-- native events
        OR
         USERAGENT like '%mobile_native_v3%' -- webkit wrapped forwarded via native app
        THEN 'native app'
    WHEN USERAGENT like '%mobile_wrap:{platform:ios%' THEN 'mobile wrap ios'
    WHEN USERAGENT like '%mobile_wrap: {"platform":"android"%' THEN 'mobile wrap android'
    WHEN DVCE_TYPE = 'Computer' THEN 'web'
    WHEN DVCE_TYPE = 'Mobile' THEN 'mobile web'
    WHEN DVCE_TYPE = 'Tablet' THEN 'tablet web'
    WHEN DVCE_TYPE != 'Unknown' THEN lower(DVCE_TYPE)
    ELSE 'not specified'
    END                                                                                             AS device_platform,

--device type
CASE
    WHEN APP_ID LIKE 'ios_app%' OR USERAGENT like '%mobile_native_v3%' THEN 'Mobile'
    WHEN DVCE_TYPE != 'Unknown' THEN DVCE_TYPE
    ELSE 'Unknown'
    END                                                                                             AS device_category,

-- SE ip addresses

CASE
    WHEN USER_IPADDRESS IN (
        '89.197.56.3'
        )
        THEN TRUE
    ELSE FALSE END                                                                                  AS is_internal_ip_address_event,
-- Server side event

CASE
--     WHEN CONTEXTS_COM_SECRETESCAPES_ENVIRONMENT_CONTEXT_1[0]['tracking_platform']::VARCHAR = 'server-side' THEN TRUE
    WHEN V_TRACKER LIKE 'py-%' OR V_TRACKER LIKE 'java-%' THEN TRUE
    ELSE FALSE END                                                                                  AS is_server_side_event,

--enrichment

CONTEXTS_COM_SECRETESCAPES_ALL_PAGES_SESSION_LOGIN_TYPE_CONTEXT_1[0]['session_login_type']::VARCHAR AS LOGIN_TYPE,            --SEMI_MANUAL_LOGIN, EMAIL_SEMI_LOGIN, REMEMBERED, LOGGED_OUT, REGISTERED, FB_LOGIN, UNKNOWN, MANUAL_LOGIN, GOOGLE_REGISTER, FB_REGISTER, GOOGLE_LOGIN, EMAIL
NULLIF(
        COALESCE(CONTEXTS_COM_SECRETESCAPES_SALE_PAGE_CONTEXT_1[0]['sale_id']::VARCHAR, -- prior to SS tracking
                 CONTEXTS_COM_SECRETESCAPES_SECRET_ESCAPES_SALE_CONTEXT_1[0]['id']::VARCHAR -- SS tracking
            ), '0') --null for when sale id is set to 0.
                                                                                                    AS SE_SALE_ID,
CONTEXTS_COM_SECRETESCAPES_SALE_PAGE_CONTEXT_1[0]['sale_type']::VARCHAR                             AS SALE_TYPE,             -- HOTEL, PACKAGE, FLASH, DAY, TRAVEL, HOTEL_PLUS, UNKNOWN
CONTEXTS_COM_SECRETESCAPES_SALE_PAGE_CONTEXT_1[0]['travel_type_info']::VARCHAR                      AS SALE_TRAVEL_TYPE_INFO, -- HOTEL, HOTEL_PLUS, STATIC_PACKAGE, IHP_CONNECTED, DYNAMIC_PACKAGE, UNSUPPORTED, VOUCHER, UNKNOWN
CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1[0]['affiliate_id']::VARCHAR                         AS AFFILIATE_ID,
CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1[0]['affiliate_name']::VARCHAR                       AS AFFILIATE_NAME,        -- Secret Escapes DE, ES magazine, Secret Escapes IT, Google CPL Germany - Brand, Secret Escapes SE, Secret Escapes FR, Google PPC Brand Sign-ups, Secret Escapes NL, Secret Escapes DE for mobile wrap, Brand PPC Members (CPA), Google CPL Germany - Non-Brand, Google CPL Italy - Brand
CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1[0]['original_affiliate_id']::VARCHAR                AS ORIGINAL_AFFILIATE_ID,
CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1[0]['original_affiliate_name']::VARCHAR              AS ORIGINAL_AFFILIATE_NAME,

--original columns
APP_ID,
PLATFORM,
ETL_TSTAMP,
COLLECTOR_TSTAMP,
DVCE_CREATED_TSTAMP,
EVENT,
EVENT_ID,
TXN_ID,
NAME_TRACKER,
V_TRACKER,
V_COLLECTOR,
V_ETL,
USER_ID,
USER_IPADDRESS,
USER_FINGERPRINT,
DOMAIN_USERID,
DOMAIN_SESSIONIDX,
NETWORK_USERID,
GEO_COUNTRY,
GEO_REGION,
GEO_CITY,
GEO_ZIPCODE,
GEO_LATITUDE,
GEO_LONGITUDE,
GEO_REGION_NAME,
IP_ISP,
IP_ORGANIZATION,
IP_DOMAIN,
IP_NETSPEED,
PAGE_URL,
PAGE_TITLE,
PAGE_REFERRER,
PAGE_URLSCHEME,
PAGE_URLHOST,
PAGE_URLPORT,
PAGE_URLPATH,
PAGE_URLQUERY,
PAGE_URLFRAGMENT,
REFR_URLSCHEME,
REFR_URLHOST,
REFR_URLPORT,
REFR_URLPATH,
REFR_URLQUERY,
REFR_URLFRAGMENT,
REFR_MEDIUM,
REFR_SOURCE,
REFR_TERM,
MKT_MEDIUM,
MKT_SOURCE,
MKT_TERM,
MKT_CONTENT,
MKT_CAMPAIGN,
SE_CATEGORY,
SE_ACTION,
SE_LABEL,
SE_PROPERTY,
SE_VALUE,
TR_ORDERID,
TR_AFFILIATION,
TR_TOTAL,
TR_TAX,
TR_SHIPPING,
TR_CITY,
TR_STATE,
TR_COUNTRY,
TI_ORDERID,
TI_SKU,
TI_NAME,
TI_CATEGORY,
TI_PRICE,
TI_QUANTITY,
PP_XOFFSET_MIN,
PP_XOFFSET_MAX,
PP_YOFFSET_MIN,
PP_YOFFSET_MAX,
USERAGENT,
BR_NAME,
BR_FAMILY,
BR_VERSION,
BR_TYPE,
BR_RENDERENGINE,
BR_LANG,
BR_FEATURES_PDF,
BR_FEATURES_FLASH,
BR_FEATURES_JAVA,
BR_FEATURES_DIRECTOR,
BR_FEATURES_QUICKTIME,
BR_FEATURES_REALPLAYER,
BR_FEATURES_WINDOWSMEDIA,
BR_FEATURES_GEARS,
BR_FEATURES_SILVERLIGHT,
BR_COOKIES,
BR_COLORDEPTH,
BR_VIEWWIDTH,
BR_VIEWHEIGHT,
OS_NAME,
OS_FAMILY,
OS_MANUFACTURER,
OS_TIMEZONE,
DVCE_TYPE,
DVCE_ISMOBILE,
DVCE_SCREENWIDTH,
DVCE_SCREENHEIGHT,
DOC_CHARSET,
DOC_WIDTH,
DOC_HEIGHT,
TR_CURRENCY,
TR_TOTAL_BASE,
TR_TAX_BASE,
TR_SHIPPING_BASE,
TI_CURRENCY,
TI_PRICE_BASE,
BASE_CURRENCY,
GEO_TIMEZONE,
MKT_CLICKID,
MKT_NETWORK,
ETL_TAGS,
DVCE_SENT_TSTAMP,
REFR_DOMAIN_USERID,
REFR_DVCE_TSTAMP,
DOMAIN_SESSIONID,
DERIVED_TSTAMP,
EVENT_VENDOR,
EVENT_NAME,
EVENT_FORMAT,
EVENT_VERSION,
EVENT_FINGERPRINT,
TRUE_TSTAMP,
CONTEXTS_COM_OPTIMIZELY_SNOWPLOW_OPTIMIZELY_SUMMARY_1,
CONTEXTS_COM_SECRETESCAPES_ALL_PAGES_SESSION_LOGIN_TYPE_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_SALE_PAGE_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1,
CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_UA_PARSER_CONTEXT_1,
CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_WEB_PAGE_1,
CONTEXTS_ORG_W3_PERFORMANCE_TIMING_1,
UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_SNOWPLOW_LINK_CLICK_1,
CONTEXTS_COM_OPTIMIZELY_OPTIMIZELYX_SUMMARY_1,
CONTEXTS_COM_SECRETESCAPES_COLLECTION_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_FILTER_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_SCREEN_CONTEXT_1,
CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_APPLICATION_BACKGROUND_1,
CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_APPLICATION_FOREGROUND_1,
CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_CLIENT_SESSION_1,
CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_MOBILE_CONTEXT_1,
UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_SNOWPLOW_SCREEN_VIEW_1,
UNSTRUCT_EVENT_COM_SECRETESCAPES_SEARCHED_WITH_REFINEMENT_EVENT_1,
CONTEXTS_COM_OPTIMIZELY_EXPERIMENT_1,
CONTEXTS_COM_OPTIMIZELY_STATE_1,
CONTEXTS_COM_OPTIMIZELY_VARIATION_1,
CONTEXTS_COM_OPTIMIZELY_VISITOR_1,
CONTEXTS_COM_OPTIMIZELY_VISITOR_AUDIENCE_1,
CONTEXTS_COM_OPTIMIZELY_VISITOR_DIMENSION_1,
UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_MOBILE_SCREEN_VIEW_1,
CONTEXTS_COM_SECRETESCAPES_BOOKING_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_CONTENT_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_ENVIRONMENT_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_SECRET_ESCAPES_SALE_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_USER_CONTEXT_1,
CONTEXTS_COM_SECRETESCAPES_WHO_PUTS_PRODUCT_IN_FRONT_CUSTOMER_CONTEXT_1,
UNSTRUCT_EVENT_COM_SECRETESCAPES_BOOKING_UPDATE_EVENT_1,

CURRENT_TIMESTAMP                                                                                   AS updated_at
from SNOWPLOW_SAMPLE_EVENTS
WHERE ETL_TSTAMP::DATE = '2019-12-12'
;

------------------------------------------------------------------------------------------------------------------------
--event_stream
SELECT DATE_TRUNC(day, ETL_TSTAMP)::DATE AS date,
       count(*)
FROM EVENT_STREAM
GROUP BY 1
ORDER BY 1;

--sample_events
SELECT DATE_TRUNC(day, ETL_TSTAMP)::DATE AS date,
       count(*)
FROM SNOWPLOW_SAMPLE_EVENTS
GROUP BY 1
ORDER BY 1;

--atomic_events
SELECT DATE_TRUNC(day, ETL_TSTAMP)::DATE AS date,
       count(*)
FROM SNOWPLOW.ATOMIC.EVENTS
WHERE ETL_TSTAMP >= (SELECT MIN(ETL_TSTAMP)::DATE FROM SNOWPLOW_SAMPLE_EVENTS)
GROUP BY 1
ORDER BY 1;

CREATE OR REPLACE TABLE RAW_VAULT_DEV_TESTS_ROBIN.ATOMIC_EVENTS_HYGIENE.EVENT_STREAM_NO_PII AS (
    SELECT EVENT_HASH,
           identity_fragment,
           SE_USER_ID,
           IS_ROBOT_SPIDER_EVENT,
           EVENT_TSTAMP,
           POSA_TERRITORY,
           DEVICE_PLATFORM,
           DEVICE_CATEGORY,
           IS_INTERNAL_IP_ADDRESS_EVENT,
           IS_SERVER_SIDE_EVENT,
           LOGIN_TYPE,
           SE_SALE_ID,
           SALE_TYPE,
           SALE_TRAVEL_TYPE_INFO,
           AFFILIATE_ID,
           AFFILIATE_NAME,
           ORIGINAL_AFFILIATE_ID,
           ORIGINAL_AFFILIATE_NAME,
           APP_ID,
           PLATFORM,
           ETL_TSTAMP,
           COLLECTOR_TSTAMP,
           DVCE_CREATED_TSTAMP,
           EVENT,
           EVENT_ID,
           TXN_ID,
           NAME_TRACKER,
           V_TRACKER,
           V_COLLECTOR,
           V_ETL,
           USER_ID,
           USER_IPADDRESS,
           USER_FINGERPRINT,
           DOMAIN_USERID,
           DOMAIN_SESSIONIDX,
           NETWORK_USERID,
           GEO_COUNTRY,
           GEO_REGION,
           GEO_CITY,
           GEO_ZIPCODE,
           GEO_LATITUDE,
           GEO_LONGITUDE,
           GEO_REGION_NAME,
           IP_ISP,
           IP_ORGANIZATION,
           IP_DOMAIN,
           IP_NETSPEED,
           MD5(PAGE_URL) AS PAGE_URL,
           PAGE_TITLE,
           MD5(PAGE_REFERRER) AS PAGE_REFERRER,
           PAGE_URLSCHEME,
           PAGE_URLHOST,
           PAGE_URLPORT,
           PAGE_URLPATH,
           PAGE_URLQUERY,
           PAGE_URLFRAGMENT,
           REFR_URLSCHEME,
           REFR_URLHOST,
           REFR_URLPORT,
           REFR_URLPATH,
           REFR_URLQUERY,
           REFR_URLFRAGMENT,
           REFR_MEDIUM,
           REFR_SOURCE,
           REFR_TERM,
           MKT_MEDIUM,
           MKT_SOURCE,
           MKT_TERM,
           MKT_CONTENT,
           MKT_CAMPAIGN,
           SE_CATEGORY,
           SE_ACTION,
           SE_LABEL,
           SE_PROPERTY,
           SE_VALUE,
           TR_ORDERID,
           TR_AFFILIATION,
           TR_TOTAL,
           TR_TAX,
           TR_SHIPPING,
           TR_CITY,
           TR_STATE,
           TR_COUNTRY,
           TI_ORDERID,
           TI_SKU,
           TI_NAME,
           TI_CATEGORY,
           TI_PRICE,
           TI_QUANTITY,
           PP_XOFFSET_MIN,
           PP_XOFFSET_MAX,
           PP_YOFFSET_MIN,
           PP_YOFFSET_MAX,
           USERAGENT,
           BR_NAME,
           BR_FAMILY,
           BR_VERSION,
           BR_TYPE,
           BR_RENDERENGINE,
           BR_LANG,
           BR_FEATURES_PDF,
           BR_FEATURES_FLASH,
           BR_FEATURES_JAVA,
           BR_FEATURES_DIRECTOR,
           BR_FEATURES_QUICKTIME,
           BR_FEATURES_REALPLAYER,
           BR_FEATURES_WINDOWSMEDIA,
           BR_FEATURES_GEARS,
           BR_FEATURES_SILVERLIGHT,
           BR_COOKIES,
           BR_COLORDEPTH,
           BR_VIEWWIDTH,
           BR_VIEWHEIGHT,
           OS_NAME,
           OS_FAMILY,
           OS_MANUFACTURER,
           OS_TIMEZONE,
           DVCE_TYPE,
           DVCE_ISMOBILE,
           DVCE_SCREENWIDTH,
           DVCE_SCREENHEIGHT,
           DOC_CHARSET,
           DOC_WIDTH,
           DOC_HEIGHT,
           TR_CURRENCY,
           TR_TOTAL_BASE,
           TR_TAX_BASE,
           TR_SHIPPING_BASE,
           TI_CURRENCY,
           TI_PRICE_BASE,
           BASE_CURRENCY,
           GEO_TIMEZONE,
           MKT_CLICKID,
           MKT_NETWORK,
           ETL_TAGS,
           DVCE_SENT_TSTAMP,
           REFR_DOMAIN_USERID,
           REFR_DVCE_TSTAMP,
           DOMAIN_SESSIONID,
           DERIVED_TSTAMP,
           EVENT_VENDOR,
           EVENT_NAME,
           EVENT_FORMAT,
           EVENT_VERSION,
           EVENT_FINGERPRINT,
           TRUE_TSTAMP,
           CONTEXTS_COM_OPTIMIZELY_SNOWPLOW_OPTIMIZELY_SUMMARY_1,
           CONTEXTS_COM_SECRETESCAPES_ALL_PAGES_SESSION_LOGIN_TYPE_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_SALE_PAGE_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_USER_STATE_CONTEXT_1,
           CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_UA_PARSER_CONTEXT_1,
           CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_WEB_PAGE_1,
           CONTEXTS_ORG_W3_PERFORMANCE_TIMING_1,
           UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_SNOWPLOW_LINK_CLICK_1,
           CONTEXTS_COM_OPTIMIZELY_OPTIMIZELYX_SUMMARY_1,
           CONTEXTS_COM_SECRETESCAPES_COLLECTION_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_FILTER_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_SCREEN_CONTEXT_1,
           CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_APPLICATION_BACKGROUND_1,
           CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_APPLICATION_FOREGROUND_1,
           CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_CLIENT_SESSION_1,
           CONTEXTS_COM_SNOWPLOWANALYTICS_SNOWPLOW_MOBILE_CONTEXT_1,
           UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_SNOWPLOW_SCREEN_VIEW_1,
           UNSTRUCT_EVENT_COM_SECRETESCAPES_SEARCHED_WITH_REFINEMENT_EVENT_1,
           CONTEXTS_COM_OPTIMIZELY_EXPERIMENT_1,
           CONTEXTS_COM_OPTIMIZELY_STATE_1,
           CONTEXTS_COM_OPTIMIZELY_VARIATION_1,
           CONTEXTS_COM_OPTIMIZELY_VISITOR_1,
           CONTEXTS_COM_OPTIMIZELY_VISITOR_AUDIENCE_1,
           CONTEXTS_COM_OPTIMIZELY_VISITOR_DIMENSION_1,
           UNSTRUCT_EVENT_COM_SNOWPLOWANALYTICS_MOBILE_SCREEN_VIEW_1,
           CONTEXTS_COM_SECRETESCAPES_BOOKING_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_CONTENT_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_ENVIRONMENT_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_SECRET_ESCAPES_SALE_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_USER_CONTEXT_1,
           CONTEXTS_COM_SECRETESCAPES_WHO_PUTS_PRODUCT_IN_FRONT_CUSTOMER_CONTEXT_1,
           UNSTRUCT_EVENT_COM_SECRETESCAPES_BOOKING_UPDATE_EVENT_1,
           UPDATED_AT
    FROM RAW_VAULT_DEV_TESTS_ROBIN.ATOMIC_EVENTS_HYGIENE.EVENT_STREAM
);