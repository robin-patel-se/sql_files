CREATE OR REPLACE SEMANTIC VIEW se_dev_robin.data.booking_analysis

  TABLES (
    bookings AS se_dev_robin.data.fact_booking
      PRIMARY KEY (booking_id)
      WITH SYNONYMS ('bookings')
      COMMENT = 'All bookings made on Secret Escapes',
    sales AS se_dev_robin.data.dim_sale
      PRIMARY KEY (se_sale_id)
      COMMENT = 'List of all sales',
    customers AS se_dev_robin.data.se_user_attributes
      PRIMARY KEY (shiro_user_id)
      COMMENT = 'List of all members'
  )

  RELATIONSHIPS (
    bookings_to_sales AS
      bookings (se_sale_id) REFERENCES sales,
    bookings_to_customer AS
      bookings (shiro_user_id) REFERENCES customers
  )

  FACTS (
    bookings.margin_gbp AS margin_gross_of_toms_gbp_constant_currency
      COMMENT = 'Margin of the booking in gbp constant currency'
  )

  DIMENSIONS (
    bookings.territory AS territory
      WITH SYNONYMS = ('posa territory', 'territory')
      COMMENT = 'Territory of the booking',
  	bookings.booking_date AS booking_completed_date
      WITH SYNONYMS = ('booking date', 'booking completed date', 'date of booking')
      COMMENT = 'Territory of the booking',
	bookings.status AS booking_status_type
      WITH SYNONYMS = ('booking status', 'status', 'booking_status_type')
      COMMENT = 'Status of the booking',
	bookings.margin AS margin_g
      WITH SYNONYMS = ('booking status', 'status', 'booking_status_type')
      COMMENT = 'Status of the booking',
    sales.sale_type AS product_configuration
      COMMENT = 'The type of sale',
  	sales.sale_name AS sale_name
      COMMENT = 'The descriptive name of the sale',
	sales.posu_country AS posu_country
	  WITH SYNONYMS = ('destination', 'holiday country', 'holiday destination')
      COMMENT = 'The destination country of the holiday',
	sales.travel_type AS travel_type
	  WITH SYNONYMS = ('travel type', 'domestic', 'international')
      COMMENT = 'Whether the holiday is an international or domestic holiday',
    customers.affiliate AS current_affiliate_name
      COMMENT = 'Year when the order was placed'
  )

  METRICS (
    customers.customer_count AS COUNT(shiro_user_id)
      COMMENT = 'Count of number of customers',
    bookings.booking_average_margin_gbp AS AVG(margin_gross_of_toms_gbp_constant_currency)
      COMMENT = 'Average margin gbp value across all orders'
  )

  COMMENT = 'Semantic view for revenue analysis';


-- CREATE OR REPLACE VIEW se_dev_robin.data.fact_booking AS select * from se.data.fact_booking;
-- CREATE OR REPLACE VIEW se_dev_robin.data.dim_sale AS select * from se.data.dim_sale;
-- CREATE OR REPLACE VIEW se_dev_robin.data.se_user_attributes AS select * from se.data.se_user_attributes;

-- You can then go to snowflake ui navigate to se_dev_robin.data.booking_analysis and snowflake will open a chat conversation
-- where you can ask questions of the semantic view
-- https://app.snowflake.com/vm40396/ae34283/#/cortex/analyst/databases/SE_DEV_ROBIN/schemas/DATA/semanticView/BOOKING_ANALYSIS

SELECT * FROM se.data.dim_sale ds;



/*

create or replace semantic view se.data.BOOKING_ANALYSIS
	tables (
		SE.DATA.DIM_SALE primary key (SE_SALE_ID) with synonyms=('sale') comment='This table, DIM_SALE, appears to be a dimension table in a data warehouse that stores information about sales data. It contains a wide range of attributes that describe a sale, including sale details, product information, supplier and partner data, sales performance metrics, customer feedback, and geographic location. The table seems to be used for analytics and reporting purposes, providing a comprehensive view of sales data to support business decision-making.',
		SE.DATA.FACT_COMPLETE_BOOKING comment='This table contains booking data for travel accommodations, including details about the booking, customer, and financial transactions. It captures information about the booking status, travel dates, room and flight details, revenue and margin calculations, customer demographics, and cancellation history. The table also includes indices to track the customer''s booking history and frequency.',
		SE.DATA.SE_CALENDAR primary key (DATE_VALUE) comment='This view provides a comprehensive calendar dimension table that enables date-based analysis and reporting across various time periods, including year-to-date, quarter-to-date, month-to-date, and week-to-date, with alignment options for weekdays and dates, as well as comparisons to previous years and weeks.',
		SE.DATA.SE_USER_ATTRIBUTES primary key (SHIRO_USER_ID) comment='This table provides a comprehensive view of user attributes and behavior, including demographic information, affiliate and membership details, activity history, and engagement metrics, allowing for analysis of user behavior, preferences, and loyalty.'
	)
	relationships (
		BOOKING_TO_SALE as FACT_COMPLETE_BOOKING(SE_SALE_ID) references DIM_SALE(SE_SALE_ID),
		BOOKING_TO_SE_CALENDAR as FACT_COMPLETE_BOOKING(BOOKING_COMPLETED_DATE) references SE_CALENDAR(DATE_VALUE),
		BOOKING_TO_USER as FACT_COMPLETE_BOOKING(SHIRO_USER_ID) references SE_USER_ATTRIBUTES(SHIRO_USER_ID)
	)
	facts (
		FACT_COMPLETE_BOOKING.BOOKERS as SHIRO_USER_ID with synonyms=('bookers') comment='Unique Count of bookers',
		FACT_COMPLETE_BOOKING.GROSS_REVENUE_GBP_CONSTANT_CURRENCY as GROSS_REVENUE_GBP_CONSTANT_CURRENCY comment='The total revenue generated from bookings, expressed in British Pounds (GBP) and adjusted for constant currency fluctuations to ensure accurate year-over-year comparisons.',
		FACT_COMPLETE_BOOKING.MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY as MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY with synonyms=('constant_currency_gross_margin_gbp','constant_gbp_gross_profit','fixed_gbp_gross_profit_margin','gross_margin_constant_gbp','margin','toms_gross_margin_gbp_fixed_currency') comment='The margin value of a booking in GBP, calculated using the constant currency exchange rate',
		SE_CALENDAR.SE_WEEK as SE_WEEK comment='The week of the year, ranging from 1 to 52, where 1 represents the first week of the year and 52 represents the last week of the year, with the value 29 indicating an incomplete or partial week at the end of the year.',
		SE_CALENDAR.SE_YEAR as SE_YEAR comment='The year in which the data was collected or the event occurred.',
		SE_USER_ATTRIBUTES.SHIRO_USER_ID as SHIRO_USER_ID comment='Unique identifier for a user in the Shiro authentication system.'
	)
	dimensions (
		DIM_SALE.POSU_CITY as POSU_CITY with synonyms=('destination','destination city','point of supply city') comment='The city where the point of sale is located.',
		DIM_SALE.POSU_CLUSTER as POSU_CLUSTER comment='Point of Sale Usage Cluster, categorizing customers based on their purchase behavior and frequency, with 1 indicating high usage, 2 indicating medium usage, and Other indicating low or no usage.',
		DIM_SALE.POSU_CLUSTER_REGION as POSU_CLUSTER_REGION comment='Geographic region where the point of sale is located, categorized into clusters for sales analysis and reporting purposes.',
		DIM_SALE.POSU_CLUSTER_SUB_REGION as POSU_CLUSTER_SUB_REGION comment='Geographic sub-region where a point of sale is located, such as a province or island.',
		DIM_SALE.POSU_COUNTRY as POSU_COUNTRY with synonyms=('country','destination country','point of supply country','travel country') comment='The destination country the booking is made for.',
		DIM_SALE.POSU_REGION as POSU_REGION comment='The region in which the point of sale unit (POSU) is located, categorizing it as either the United Kingdom, Spain, or any other region.',
		DIM_SALE.POSU_SUB_REGION as POSU_SUB_REGION comment='Geographic sub-region where a sale was made, such as a province, state, or region within a country.',
		DIM_SALE.PRODUCT_CONFIGURATION as PRODUCT_CONFIGURATION comment='The type of sales channel or method through which a product is sold, such as directly to a hotel, through a third-party provider (3PP), or through a wholesale rate desk (WRD) directly.',
		DIM_SALE.PRODUCT_TYPE as PRODUCT_TYPE comment='Categorization of the product or service being sold, indicating whether it is a Workshop (WRD), a Day Experience, or an Unknown type.',
		DIM_SALE.SALE_ACTIVE as SALE_ACTIVE comment='Indicates whether a sale is currently active or not.',
		DIM_SALE.SALE_NAME as SALE_NAME comment='The name of the sale, which represents a specific hotel or accommodation offer, providing a descriptive title for the sale.',
		DIM_SALE.SE_BRAND as SE_BRAND comment='The brand of the airline or travel provider associated with the sale.',
		DIM_SALE.SE_SALE_ID as SE_SALE_ID comment='Unique identifier for a sales event.',
		DIM_SALE.SALE_START_DATE as SALE_START_DATE comment='The date and time when a sale started.',
		FACT_COMPLETE_BOOKING.ADULT_GUESTS as ADULT_GUESTS comment='The number of adult guests included in a booking.',
		FACT_COMPLETE_BOOKING.BOOKING_COMPLETED_DATE as BOOKING_COMPLETED_DATE comment='Date on which the booking was completed.',
		FACT_COMPLETE_BOOKING.BOOKING_COMPLETED_TIMESTAMP as BOOKING_COMPLETED_TIMESTAMP comment='The date and time at which a booking was completed.',
		FACT_COMPLETE_BOOKING.BOOKING_ID as BOOKING_ID comment='Unique identifier for a booking made by a customer.',
		FACT_COMPLETE_BOOKING.BOOKING_INCLUDES_FLIGHT as BOOKING_INCLUDES_FLIGHT comment='Indicates whether a booking includes a flight reservation.',
		FACT_COMPLETE_BOOKING.BOOKING_LEAD_TIME_DAYS as BOOKING_LEAD_TIME_DAYS comment='The number of days between when a booking was made and the actual arrival date.',
		FACT_COMPLETE_BOOKING.BOOKING_STATUS_TYPE as BOOKING_STATUS_TYPE comment='The current status of a booking, indicating whether it is active and confirmed (live), was initiated but not completed (abandoned), or falls into a miscellaneous category (other).',
		FACT_COMPLETE_BOOKING.CHECK_IN_DATE as CHECK_IN_DATE with synonyms=('arrival date','holiday date','travel date','visit date') comment='Date when the guest checked in for their booking.',
		FACT_COMPLETE_BOOKING.CHECK_OUT_DATE as CHECK_OUT_DATE with synonyms=('holiday end date','leave date','return date','visit end date') comment='Date when the guest checked out of the accommodation.',
		FACT_COMPLETE_BOOKING.CHILD_GUESTS as CHILD_GUESTS comment='Number of children guests included in the booking.',
		FACT_COMPLETE_BOOKING.CURRENCY as CURRENCY comment='The currency in which the booking was made.',
		FACT_COMPLETE_BOOKING.DAYS_SINCE_PREVIOUS_LIVE_BOOKING as DAYS_SINCE_PREVIOUS_LIVE_BOOKING with synonyms=('days since previous booking') comment='The number of days between this booking and this user''s previous booking',
		FACT_COMPLETE_BOOKING.DEVICE_PLATFORM as DEVICE_PLATFORM comment='The platform on which the booking was made, such as a web browser on a desktop or laptop computer, or a web browser on a tablet device.',
		FACT_COMPLETE_BOOKING.INFANT_GUESTS as INFANT_GUESTS comment='Number of infant guests (children under 2 years old) included in the booking.',
		FACT_COMPLETE_BOOKING.LIVE_BOOKING_INDEX as LIVE_BOOKING_INDEX with synonyms=('Booking index') comment='An indexed count for a user''s booking, eg this is user 1234 ''s 3rd booking',
		FACT_COMPLETE_BOOKING.NO_NIGHTS as NO_NIGHTS comment='The number of nights a guest stayed at the hotel.',
		FACT_COMPLETE_BOOKING.POSA_TERRITORY as TERRITORY with synonyms=('area','district','geographic_area','market_area','region','sales_territory','territory_code','zone') comment='The territory in which the booking was made, such as the United Kingdom (UK) or Germany (DE).',
		FACT_COMPLETE_BOOKING.PRICE_PER_NIGHT as PRICE_PER_NIGHT comment='The average nightly price of a booking.',
		FACT_COMPLETE_BOOKING.ROOMS as ROOMS comment='Number of rooms booked by a customer.',
		FACT_COMPLETE_BOOKING.SE_BRAND as SE_BRAND comment='The Brand within SE Group that the booking transacted in.',
		FACT_COMPLETE_BOOKING.SE_SALE_ID as SE_SALE_ID comment='Unique identifier for a sale event in the Southeast region.',
		FACT_COMPLETE_BOOKING.SHIRO_USER_ID as SHIRO_USER_ID comment='Unique identifier for the user who made the booking on the Shiro platform.',
		FACT_COMPLETE_BOOKING.TRANSACTION_ID as TRANSACTION_ID comment='Unique identifier for a booking transaction.',
		FACT_COMPLETE_BOOKING.TRAVEL_TYPE as TRAVEL_TYPE comment='Type of travel, indicating whether the booking is for a trip within the same country (Domestic), to another country (International), or the type of travel is not specified (Unknown).',
		SE_CALENDAR.DATE_VALUE as DATE_VALUE comment='Date of a specific event or occurrence.',
		SE_USER_ATTRIBUTES.ACQUISITION_PLATFORM as ACQUISITION_PLATFORM comment='The platform through which the user acquired the service, such as an unknown source, a web application, or a mobile web application.',
		SE_USER_ATTRIBUTES.APP_PUSH_OPT_IN_STATUS as APP_PUSH_OPT_IN_STATUS comment='Indicates whether a user has chosen to receive push notifications from the application, with possible values of "opted in" (user has chosen to receive push notifications) or "opted out" (user has chosen not to receive push notifications).',
		SE_USER_ATTRIBUTES.CURRENT_AFFILIATE_NAME as CURRENT_AFFILIATE_NAME comment='The name of the affiliate or partner that the user is currently associated with, indicating the source or origin of the user''s account.',
		SE_USER_ATTRIBUTES.EMAIL_OPT_IN_STATUS as EMAIL_OPT_IN_STATUS comment='The user''s email preference for receiving notifications, with options for daily updates, weekly summaries, or opting out of email communications altogether.',
		SE_USER_ATTRIBUTES.HAS_APP_INSTALLED as HAS_APP_INSTALLED comment='Indicates whether the user has installed the mobile app.',
		SE_USER_ATTRIBUTES.IS_TEST_USER as IS_TEST_USER comment='Indicates whether the user is a test user or not.',
		SE_USER_ATTRIBUTES.MAIN_AFFILIATE_NAME as MAIN_AFFILIATE_NAME comment='The name of the main affiliate associated with the user, indicating the primary Secret Escapes brand or publication through which the user interacts.',
		SE_USER_ATTRIBUTES.MEMBERSHIP_ACCOUNT_STATUS as MEMBERSHIP_ACCOUNT_STATUS comment='The current status of a user''s membership account, indicating whether it is active, deactivated, or deleted.',
		SE_USER_ATTRIBUTES.ORIGINAL_AFFILIATE_NAME as ORIGINAL_AFFILIATE_NAME comment='The name of the affiliate that originally referred the user to Secret Escapes.',
		SE_USER_ATTRIBUTES.SIGNUP_TSTAMP as SIGNUP_TSTAMP comment='Timestamp when the user signed up for the service.'
	)
	with extension (CA='{"tables":[{"name":"DIM_SALE","dimensions":[{"name":"POSU_CITY","sample_values":["Big Sky","San Remo","Canico"]},{"name":"POSU_CLUSTER","sample_values":["Other","2","1"]},{"name":"POSU_CLUSTER_REGION","sample_values":["Greece","Portugal","France"]},{"name":"POSU_CLUSTER_SUB_REGION","sample_values":["Indonesia","Lazio","Crete"]},{"name":"POSU_COUNTRY","sample_values":["Slovenia","Germany","Malaysia"]},{"name":"POSU_REGION","sample_values":["UK POSu","Spain POSu","Other"]},{"name":"POSU_SUB_REGION","sample_values":["GERMANY-NORTH","Normandy","Hurghada"]},{"name":"PRODUCT_CONFIGURATION","sample_values":["Hotel","3PP","WRD - direct"]},{"name":"PRODUCT_TYPE","sample_values":["WRD","Day Experience","Unknown"]},{"name":"SALE_ACTIVE","sample_values":["TRUE","FALSE"]},{"name":"SALE_NAME","sample_values":["Hotell med havutsikt i Sanremo ","5* Italian Riviera spa hotel ","Royal Hotel Sanremo "]},{"name":"SE_BRAND","sample_values":["SE Brand","Travelist"]},{"name":"SE_SALE_ID","sample_values":["A27332","A27524","A27541"]}],"time_dimensions":[{"name":"SALE_START_DATE","sample_values":["2020-08-14T00:01:00.000+0000","2011-09-19T08:00:00.000+0000","2020-07-11T00:01:00.000+0000"]}]},{"name":"FACT_COMPLETE_BOOKING","dimensions":[{"name":"ADULT_GUESTS","sample_values":["0","2","4"]},{"name":"BOOKING_ID","sample_values":["35960771","43024869","30215330"]},{"name":"BOOKING_INCLUDES_FLIGHT","sample_values":["FALSE","TRUE"]},{"name":"BOOKING_LEAD_TIME_DAYS","sample_values":["198","15"]},{"name":"BOOKING_STATUS_TYPE","sample_values":["abandoned","cancelled","other"]},{"name":"CHILD_GUESTS","sample_values":["0","1","5"]},{"name":"CURRENCY","sample_values":["EUR","NOK","GBP"]},{"name":"DAYS_SINCE_PREVIOUS_LIVE_BOOKING"},{"name":"DEVICE_PLATFORM","sample_values":["web","tablet web"]},{"name":"INFANT_GUESTS","sample_values":["1","2","0"]},{"name":"LIVE_BOOKING_INDEX"},{"name":"NO_NIGHTS","sample_values":["2","15"]},{"name":"POSA_TERRITORY","sample_values":["UK","DE"]},{"name":"PRICE_PER_NIGHT","sample_values":["188.133800000000","407.899500000000","189.000000000000"]},{"name":"ROOMS","sample_values":["2","1","0"]},{"name":"SE_BRAND","sample_values":["SE Brand","Travelist"]},{"name":"SE_SALE_ID","sample_values":["106137","75486","3206"]},{"name":"SHIRO_USER_ID","sample_values":["13430332","9856191","65423270"]},{"name":"TRANSACTION_ID","sample_values":["A60593-30019-17558436","A5843-3460-668348","A40100-23265-6402845"]},{"name":"TRAVEL_TYPE","sample_values":["International","Domestic","Unknown"]}],"facts":[{"name":"BOOKERS","default_aggregation":6,"sample_values":["47427470","52994948","28976911"]},{"name":"GROSS_REVENUE_GBP_CONSTANT_CURRENCY","default_aggregation":1,"sample_values":["223.234700000","444.803500000","200.000000000"]},{"name":"MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY","default_aggregation":1}],"filters":[{"name":"LIVE_BOOKINGS","synonyms":["live bookings"],"description":"Filter to only live bookings","expr":"booking_status_type = ''live''"},{"name":"SE_BRAND_BOOKINGS","synonyms":["se brand"],"description":"Bookings that occurred in the SE Brand","expr":"se_brand = ''SE Brand''"}],"time_dimensions":[{"name":"BOOKING_COMPLETED_DATE","sample_values":["2017-02-28","2017-01-09"]},{"name":"BOOKING_COMPLETED_TIMESTAMP","sample_values":["2018-03-11T22:25:25.000+0000","2018-10-11T03:20:22.000+0000","2019-01-25T11:04:11.000+0000"]},{"name":"CHECK_IN_DATE","sample_values":["2013-10-03","2015-08-30","2022-04-05"]},{"name":"CHECK_OUT_DATE","sample_values":["2019-03-31","2018-05-08","2017-07-15"]}]},{"name":"SE_CALENDAR","facts":[{"name":"SE_WEEK","sample_values":["29","1","2"]},{"name":"SE_YEAR","sample_values":["1972","1971","1970"]}],"time_dimensions":[{"name":"DATE_VALUE","sample_values":["1970-04-09","1970-01-30","1970-01-02"]}]},{"name":"SE_USER_ATTRIBUTES","dimensions":[{"name":"ACQUISITION_PLATFORM","sample_values":["UNKNOWN","WEB","MOBILE_WEB"]},{"name":"APP_PUSH_OPT_IN_STATUS","sample_values":["opted in","opted out"]},{"name":"CURRENT_AFFILIATE_NAME","sample_values":["Secret Escapes IT","Unister generic","Google CPL Germany - Non-Brand (UK Campaign)"]},{"name":"EMAIL_OPT_IN_STATUS","sample_values":["daily","weekly","opted out"]},{"name":"HAS_APP_INSTALLED","sample_values":["TRUE","FALSE"]},{"name":"IS_TEST_USER","sample_values":["TRUE","FALSE"]},{"name":"MAIN_AFFILIATE_NAME","sample_values":["Secret Escapes ES","ES magazine","Secret Escapes IT"]},{"name":"MEMBERSHIP_ACCOUNT_STATUS","sample_values":["DEACTIVATED","FULL_ACCOUNT","DELETED"]},{"name":"ORIGINAL_AFFILIATE_NAME","sample_values":["facebook ads","PF2017 Smart","Secret Escapes SK"]}],"facts":[{"name":"SHIRO_USER_ID","sample_values":["35343862","39445427","30470101"]}],"filters":[{"name":"ACTIVE_ACCOUNTS","synonyms":["active user accounts","users with an active account"],"description":"Active user accounts","expr":"MEMBERSHIP_ACCOUNT_STATUS = ''FULL_ACCOUNT''"}],"time_dimensions":[{"name":"SIGNUP_TSTAMP","sample_values":["2016-07-08T20:21:41.000+0000","2018-10-03T13:19:36.000+0000","2025-04-14T18:24:50.000+0000"]}]}],"relationships":[{"name":"BOOKING_TO_SALE"},{"name":"BOOKING_TO_SE_CALENDAR"},{"name":"BOOKING_TO_USER"}],"verified_queries":[{"name":"show me live bookings to destination Germany yesterday","question":"Show me live bookings to destination Germany yesterday","sql":"SELECT\\n  fb.booking_id,\\n  fb.booking_completed_date,\\n  fb.shiro_user_id,\\n  fb.gross_revenue_gbp_constant_currency,\\n  fb.margin_gross_of_toms_gbp_constant_currency\\nFROM\\n  fact_complete_booking AS fb\\n  INNER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id\\nWHERE\\n  fb.booking_status_type = ''live''\\n  AND ds.posu_country = ''Germany''\\n  AND fb.booking_completed_date = CURRENT_DATE - INTERVAL ''1 DAY''\\nORDER BY\\n  fb.booking_completed_date DESC NULLS LAST","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763635738},{"name":"Show me live bookings for se brand per month for 2025","question":"Show me live bookings for se brand per month for 2025","sql":"SELECT\\n  DATE_TRUNC(''MONTH'', fb.booking_completed_date) AS month,\\n  COUNT(fb.booking_id) AS booking_count,\\n  SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_revenue_gbp\\nFROM\\n  fact_complete_booking AS fb\\nWHERE\\n  fb.booking_status_type = ''live''\\n  AND fb.se_brand = ''SE Brand''\\n  AND DATE_PART(''year'', fb.booking_completed_date) = 2025\\nGROUP BY\\n  DATE_TRUNC(''MONTH'', fb.booking_completed_date)\\nORDER BY\\n  month DESC NULLS LAST","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763635746},{"name":"give me a summary of bookings that were made on se brand yesterday","question":"give me a summary of bookings that were made on se brand yesterday","sql":"SELECT\\n  COUNT(fb.booking_id) AS booking_count,\\n  SUM(fb.gross_revenue_gbp_constant_currency) AS total_revenue_gbp,\\n  SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_margin_gbp\\nFROM\\n  fact_complete_booking AS fb\\nWHERE\\n  fb.se_brand = ''SE Brand''\\n  AND fb.booking_completed_date = CURRENT_DATE - INTERVAL ''1 DAY''","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763635811},{"name":"Compare se week 46 this year versus last year","question":"Compare se week 46 this year versus last year","sql":"WITH week_46_2025 AS (\\n  SELECT\\n    COUNT(fb.booking_id) AS booking_count,\\n    SUM(fb.gross_revenue_gbp_constant_currency) AS total_revenue_gbp,\\n    SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_margin_gbp\\n  FROM\\n    fact_complete_booking AS fb\\n    LEFT OUTER JOIN se_calendar AS cal ON fb.booking_completed_date = cal.date_value\\n  WHERE\\n    cal.se_week = 46\\n    AND cal.se_year = 2025\\n),\\nweek_46_2024 AS (\\n  SELECT\\n    COUNT(fb.booking_id) AS booking_count,\\n    SUM(fb.gross_revenue_gbp_constant_currency) AS total_revenue_gbp,\\n    SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_margin_gbp\\n  FROM\\n    fact_complete_booking AS fb\\n    LEFT OUTER JOIN se_calendar AS cal ON fb.booking_completed_date = cal.date_value\\n  WHERE\\n    cal.se_week = 46\\n    AND cal.se_year = 2024\\n)\\nSELECT\\n  2025 AS curr_year,\\n  2024 AS prev_year,\\n  curr.booking_count AS curr_booking_count,\\n  prev.booking_count AS prev_booking_count,\\n  curr.total_revenue_gbp AS curr_total_revenue_gbp,\\n  prev.total_revenue_gbp AS prev_total_revenue_gbp,\\n  curr.total_margin_gbp AS curr_total_margin_gbp,\\n  prev.total_margin_gbp AS prev_total_margin_gbp,\\n  curr.booking_count - prev.booking_count AS booking_count_yoy_chg,\\n  (curr.booking_count - prev.booking_count) / NULLIF(NULLIF(prev.booking_count, 0), 0) AS booking_count_yoy_pct_chg,\\n  curr.total_revenue_gbp - prev.total_revenue_gbp AS revenue_yoy_chg,\\n  (curr.total_revenue_gbp - prev.total_revenue_gbp) / NULLIF(NULLIF(prev.total_revenue_gbp, 0), 0) AS revenue_yoy_pct_chg,\\n  curr.total_margin_gbp - prev.total_margin_gbp AS margin_yoy_chg,\\n  (curr.total_margin_gbp - prev.total_margin_gbp) / NULLIF(NULLIF(prev.total_margin_gbp, 0), 0) AS margin_yoy_pct_chg\\nFROM\\n  week_46_2025 AS curr\\n  CROSS JOIN week_46_2024 AS prev","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763636020},{"name":"how many bookings did we make yesterday","question":"how many bookings did we make yesterday","sql":"SELECT\\n  COUNT(fb.booking_id) AS booking_count\\nFROM\\n  fact_complete_booking AS fb\\nWHERE\\n  fb.booking_completed_date = CURRENT_DATE - INTERVAL ''1 DAY''","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763656788},{"name":"create some buckets of 1, 2, 3 - 5, and 6+ bookers and show me how many people are in each bucket for bookings this year","question":"create some buckets of 1, 2, 3 - 5, and 6+ bookers and show me how many people are in each bucket for bookings this year","sql":"WITH user_bookings AS (\\n  SELECT\\n    sv.shiro_user_id,\\n    COUNT(*) AS booking_count\\n  FROM\\n    SEMANTIC_VIEW(\\n      SE.DATA.BOOKING_ANALYSIS FACTS fact_complete_booking.shiro_user_id\\n      WHERE\\n        DATE_PART(''YEAR'', booking_completed_date) = DATE_PART(''YEAR'', CURRENT_DATE)\\n        AND booking_status_type = ''live''\\n    ) AS sv\\n  GROUP BY\\n    sv.shiro_user_id\\n),\\nbooking_buckets AS (\\n  SELECT\\n    shiro_user_id,\\n    booking_count,\\n    CASE\\n      WHEN booking_count = 1 THEN ''1 booking''\\n      WHEN booking_count = 2 THEN ''2 bookings''\\n      WHEN booking_count BETWEEN 3\\n      AND 5 THEN ''3-5 bookings''\\n      WHEN booking_count >= 6 THEN ''6+ bookings''\\n    END AS booking_bucket\\n  FROM\\n    user_bookings\\n)\\nSELECT\\n  booking_bucket,\\n  COUNT(*) AS people_count\\nFROM\\n  booking_buckets\\nGROUP BY\\n  booking_bucket\\nORDER BY\\n  CASE\\n    booking_bucket\\n    WHEN ''1 booking'' THEN 1\\n    WHEN ''2 bookings'' THEN 2\\n    WHEN ''3-5 bookings'' THEN 3\\n    WHEN ''6+ bookings'' THEN 4\\n  END","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763657153}],"module_custom_instructions":{"sql_generation":"Unless asked not to, always apply the named filters SE_BRAND_BOOKINGS and LIVE_BOOKINGS"}}');
*/


create or replace semantic view se.data.BOOKING_ANALYSIS

	tables (
		SE.DATA.DIM_SALE primary key (SE_SALE_ID) with synonyms=('sale') comment='This table, DIM_SALE, appears to be a dimension table in a data warehouse that stores information about sales data. It contains a wide range of attributes that describe a sale, including sale details, product information, supplier and partner data, sales performance metrics, customer feedback, and geographic location. The table seems to be used for analytics and reporting purposes, providing a comprehensive view of sales data to support business decision-making.',
		SE.DATA.FACT_COMPLETE_BOOKING comment='This table contains booking data for travel accommodations, including details about the booking, customer, and financial transactions. It captures information about the booking status, travel dates, room and flight details, revenue and margin calculations, customer demographics, and cancellation history. The table also includes indices to track the customer''s booking history and frequency.',
		SE.DATA.SE_CALENDAR primary key (DATE_VALUE) comment='This view provides a comprehensive calendar dimension table that enables date-based analysis and reporting across various time periods, including year-to-date, quarter-to-date, month-to-date, and week-to-date, with alignment options for weekdays and dates, as well as comparisons to previous years and weeks.',
		SE.DATA.SE_USER_ATTRIBUTES primary key (SHIRO_USER_ID) comment='This table provides a comprehensive view of user attributes and behavior, including demographic information, affiliate and membership details, activity history, and engagement metrics, allowing for analysis of user behavior, preferences, and loyalty.'
	)
	relationships (
		BOOKING_TO_SALE as FACT_COMPLETE_BOOKING(SE_SALE_ID) references DIM_SALE(SE_SALE_ID),
		BOOKING_TO_SE_CALENDAR as FACT_COMPLETE_BOOKING(BOOKING_COMPLETED_DATE) references SE_CALENDAR(DATE_VALUE),
		BOOKING_TO_USER as FACT_COMPLETE_BOOKING(SHIRO_USER_ID) references SE_USER_ATTRIBUTES(SHIRO_USER_ID)
	)
	facts (
		FACT_COMPLETE_BOOKING.BOOKERS as SHIRO_USER_ID with synonyms=('bookers') comment='Unique Count of bookers',
		FACT_COMPLETE_BOOKING.GROSS_REVENUE_GBP_CONSTANT_CURRENCY as GROSS_REVENUE_GBP_CONSTANT_CURRENCY comment='The total revenue generated from bookings, expressed in British Pounds (GBP) and adjusted for constant currency fluctuations to ensure accurate year-over-year comparisons.',
		FACT_COMPLETE_BOOKING.MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY as MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY with synonyms=('constant_currency_gross_margin_gbp','constant_gbp_gross_profit','fixed_gbp_gross_profit_margin','gross_margin_constant_gbp','margin','toms_gross_margin_gbp_fixed_currency') comment='The margin value of a booking in GBP, calculated using the constant currency exchange rate',
		SE_CALENDAR.SE_WEEK as SE_WEEK comment='The week of the year, ranging from 1 to 52, where 1 represents the first week of the year and 52 represents the last week of the year, with the value 29 indicating an incomplete or partial week at the end of the year.',
		SE_CALENDAR.SE_YEAR as SE_YEAR comment='The year in which the data was collected or the event occurred.',
		SE_USER_ATTRIBUTES.SHIRO_USER_ID as SHIRO_USER_ID comment='Unique identifier for a user in the Shiro authentication system.'
	)
	dimensions (
		DIM_SALE.POSU_CITY as POSU_CITY with synonyms=('destination','destination city','point of supply city') comment='The city where the point of sale is located.',
		DIM_SALE.POSU_CLUSTER as POSU_CLUSTER comment='Point of Sale Usage Cluster, categorizing customers based on their purchase behavior and frequency, with 1 indicating high usage, 2 indicating medium usage, and Other indicating low or no usage.',
		DIM_SALE.POSU_CLUSTER_REGION as POSU_CLUSTER_REGION comment='Geographic region where the point of sale is located, categorized into clusters for sales analysis and reporting purposes.',
		DIM_SALE.POSU_CLUSTER_SUB_REGION as POSU_CLUSTER_SUB_REGION comment='Geographic sub-region where a point of sale is located, such as a province or island.',
		DIM_SALE.POSU_COUNTRY as POSU_COUNTRY with synonyms=('country','destination country','point of supply country','travel country') comment='The destination country the booking is made for.',
		DIM_SALE.POSU_REGION as POSU_REGION comment='The region in which the point of sale unit (POSU) is located, categorizing it as either the United Kingdom, Spain, or any other region.',
		DIM_SALE.POSU_SUB_REGION as POSU_SUB_REGION comment='Geographic sub-region where a sale was made, such as a province, state, or region within a country.',
		DIM_SALE.PRODUCT_CONFIGURATION as PRODUCT_CONFIGURATION comment='The type of sales channel or method through which a product is sold, such as directly to a hotel, through a third-party provider (3PP), or through a wholesale rate desk (WRD) directly.',
		DIM_SALE.PRODUCT_TYPE as PRODUCT_TYPE comment='Categorization of the product or service being sold, indicating whether it is a Workshop (WRD), a Day Experience, or an Unknown type.',
		DIM_SALE.SALE_ACTIVE as SALE_ACTIVE comment='Indicates whether a sale is currently active or not.',
		DIM_SALE.SALE_NAME as SALE_NAME comment='The name of the sale, which represents a specific hotel or accommodation offer, providing a descriptive title for the sale.',
		DIM_SALE.SE_BRAND as SE_BRAND comment='The brand of the airline or travel provider associated with the sale.',
		DIM_SALE.SE_SALE_ID as SE_SALE_ID comment='Unique identifier for a sales event.',
		DIM_SALE.SALE_START_DATE as SALE_START_DATE comment='The date and time when a sale started.',
		FACT_COMPLETE_BOOKING.ADULT_GUESTS as ADULT_GUESTS comment='The number of adult guests included in a booking.',
		FACT_COMPLETE_BOOKING.BOOKING_COMPLETED_DATE as BOOKING_COMPLETED_DATE comment='Date on which the booking was completed.',
		FACT_COMPLETE_BOOKING.BOOKING_COMPLETED_TIMESTAMP as BOOKING_COMPLETED_TIMESTAMP comment='The date and time at which a booking was completed.',
		FACT_COMPLETE_BOOKING.BOOKING_ID as BOOKING_ID comment='Unique identifier for a booking made by a customer.',
		FACT_COMPLETE_BOOKING.BOOKING_INCLUDES_FLIGHT as BOOKING_INCLUDES_FLIGHT comment='Indicates whether a booking includes a flight reservation.',
		FACT_COMPLETE_BOOKING.BOOKING_LEAD_TIME_DAYS as BOOKING_LEAD_TIME_DAYS comment='The number of days between when a booking was made and the actual arrival date.',
		FACT_COMPLETE_BOOKING.BOOKING_STATUS_TYPE as BOOKING_STATUS_TYPE comment='The current status of a booking, indicating whether it is active and confirmed (live), was initiated but not completed (abandoned), or falls into a miscellaneous category (other).',
		FACT_COMPLETE_BOOKING.CHECK_IN_DATE as CHECK_IN_DATE with synonyms=('arrival date','holiday date','travel date','visit date') comment='Date when the guest checked in for their booking.',
		FACT_COMPLETE_BOOKING.CHECK_OUT_DATE as CHECK_OUT_DATE with synonyms=('holiday end date','leave date','return date','visit end date') comment='Date when the guest checked out of the accommodation.',
		FACT_COMPLETE_BOOKING.CHILD_GUESTS as CHILD_GUESTS comment='Number of children guests included in the booking.',
		FACT_COMPLETE_BOOKING.CURRENCY as CURRENCY comment='The currency in which the booking was made.',
		FACT_COMPLETE_BOOKING.DAYS_SINCE_PREVIOUS_LIVE_BOOKING as DAYS_SINCE_PREVIOUS_LIVE_BOOKING with synonyms=('days since previous booking') comment='The number of days between this booking and this user''s previous booking',
		FACT_COMPLETE_BOOKING.DEVICE_PLATFORM as DEVICE_PLATFORM comment='The platform on which the booking was made, such as a web browser on a desktop or laptop computer, or a web browser on a tablet device.',
		FACT_COMPLETE_BOOKING.INFANT_GUESTS as INFANT_GUESTS comment='Number of infant guests (children under 2 years old) included in the booking.',
		FACT_COMPLETE_BOOKING.LIVE_BOOKING_INDEX as LIVE_BOOKING_INDEX with synonyms=('Booking index') comment='An indexed count for a user''s booking, eg this is user 1234 ''s 3rd booking',
		FACT_COMPLETE_BOOKING.NO_NIGHTS as NO_NIGHTS comment='The number of nights a guest stayed at the hotel.',
		FACT_COMPLETE_BOOKING.POSA_TERRITORY as TERRITORY with synonyms=('area','district','geographic_area','market_area','region','sales_territory','territory_code','zone') comment='The territory in which the booking was made, such as the United Kingdom (UK) or Germany (DE).',
		FACT_COMPLETE_BOOKING.PRICE_PER_NIGHT as PRICE_PER_NIGHT comment='The average nightly price of a booking.',
		FACT_COMPLETE_BOOKING.ROOMS as ROOMS comment='Number of rooms booked by a customer.',
		FACT_COMPLETE_BOOKING.SE_BRAND as SE_BRAND comment='The Brand within SE Group that the booking transacted in.',
		FACT_COMPLETE_BOOKING.SE_SALE_ID as SE_SALE_ID comment='Unique identifier for a sale event in the Southeast region.',
		FACT_COMPLETE_BOOKING.SHIRO_USER_ID as SHIRO_USER_ID comment='Unique identifier for the user who made the booking on the Shiro platform.',
		FACT_COMPLETE_BOOKING.TRANSACTION_ID as TRANSACTION_ID comment='Unique identifier for a booking transaction.',
		FACT_COMPLETE_BOOKING.TRAVEL_TYPE as TRAVEL_TYPE comment='Type of travel, indicating whether the booking is for a trip within the same country (Domestic), to another country (International), or the type of travel is not specified (Unknown).',
		SE_CALENDAR.DATE_VALUE as DATE_VALUE comment='Date of a specific event or occurrence.',
		SE_USER_ATTRIBUTES.ACQUISITION_PLATFORM as ACQUISITION_PLATFORM comment='The platform through which the user acquired the service, such as an unknown source, a web application, or a mobile web application.',
		SE_USER_ATTRIBUTES.APP_PUSH_OPT_IN_STATUS as APP_PUSH_OPT_IN_STATUS comment='Indicates whether a user has chosen to receive push notifications from the application, with possible values of "opted in" (user has chosen to receive push notifications) or "opted out" (user has chosen not to receive push notifications).',
		SE_USER_ATTRIBUTES.CURRENT_AFFILIATE_NAME as CURRENT_AFFILIATE_NAME comment='The name of the affiliate or partner that the user is currently associated with, indicating the source or origin of the user''s account.',
		SE_USER_ATTRIBUTES.EMAIL_OPT_IN_STATUS as EMAIL_OPT_IN_STATUS comment='The user''s email preference for receiving notifications, with options for daily updates, weekly summaries, or opting out of email communications altogether.',
		SE_USER_ATTRIBUTES.HAS_APP_INSTALLED as HAS_APP_INSTALLED comment='Indicates whether the user has installed the mobile app.',
		SE_USER_ATTRIBUTES.IS_TEST_USER as IS_TEST_USER comment='Indicates whether the user is a test user or not.',
		SE_USER_ATTRIBUTES.MAIN_AFFILIATE_NAME as MAIN_AFFILIATE_NAME comment='The name of the main affiliate associated with the user, indicating the primary Secret Escapes brand or publication through which the user interacts.',
		SE_USER_ATTRIBUTES.MEMBERSHIP_ACCOUNT_STATUS as MEMBERSHIP_ACCOUNT_STATUS comment='The current status of a user''s membership account, indicating whether it is active, deactivated, or deleted.',
		SE_USER_ATTRIBUTES.ORIGINAL_AFFILIATE_NAME as ORIGINAL_AFFILIATE_NAME comment='The name of the affiliate that originally referred the user to Secret Escapes.',
		SE_USER_ATTRIBUTES.SIGNUP_TSTAMP as SIGNUP_TSTAMP comment='Timestamp when the user signed up for the service.'
	)
	with extension (CA='{"tables":[{"name":"DIM_SALE","dimensions":[{"name":"POSU_CITY","sample_values":["Big Sky","San Remo","Canico"]},{"name":"POSU_CLUSTER","sample_values":["Other","2","1"]},{"name":"POSU_CLUSTER_REGION","sample_values":["Greece","Portugal","France"]},{"name":"POSU_CLUSTER_SUB_REGION","sample_values":["Indonesia","Lazio","Crete"]},{"name":"POSU_COUNTRY","sample_values":["Slovenia","Germany","Malaysia"]},{"name":"POSU_REGION","sample_values":["UK POSu","Spain POSu","Other"]},{"name":"POSU_SUB_REGION","sample_values":["GERMANY-NORTH","Normandy","Hurghada"]},{"name":"PRODUCT_CONFIGURATION","sample_values":["Hotel","3PP","WRD - direct"]},{"name":"PRODUCT_TYPE","sample_values":["WRD","Day Experience","Unknown"]},{"name":"SALE_ACTIVE","sample_values":["TRUE","FALSE"]},{"name":"SALE_NAME","sample_values":["Hotell med havutsikt i Sanremo ","5* Italian Riviera spa hotel ","Royal Hotel Sanremo "]},{"name":"SE_BRAND","sample_values":["SE Brand","Travelist"]},{"name":"SE_SALE_ID","sample_values":["A27332","A27524","A27541"]}],"time_dimensions":[{"name":"SALE_START_DATE","sample_values":["2020-08-14T00:01:00.000+0000","2011-09-19T08:00:00.000+0000","2020-07-11T00:01:00.000+0000"]}]},{"name":"FACT_COMPLETE_BOOKING","dimensions":[{"name":"ADULT_GUESTS","sample_values":["0","2","4"]},{"name":"BOOKING_ID","sample_values":["35960771","43024869","30215330"]},{"name":"BOOKING_INCLUDES_FLIGHT","sample_values":["FALSE","TRUE"]},{"name":"BOOKING_LEAD_TIME_DAYS","sample_values":["198","15"]},{"name":"BOOKING_STATUS_TYPE","sample_values":["abandoned","cancelled","other"]},{"name":"CHILD_GUESTS","sample_values":["0","1","5"]},{"name":"CURRENCY","sample_values":["EUR","NOK","GBP"]},{"name":"DAYS_SINCE_PREVIOUS_LIVE_BOOKING"},{"name":"DEVICE_PLATFORM","sample_values":["web","tablet web"]},{"name":"INFANT_GUESTS","sample_values":["1","2","0"]},{"name":"LIVE_BOOKING_INDEX"},{"name":"NO_NIGHTS","sample_values":["2","15"]},{"name":"POSA_TERRITORY","sample_values":["UK","DE"]},{"name":"PRICE_PER_NIGHT","sample_values":["188.133800000000","407.899500000000","189.000000000000"]},{"name":"ROOMS","sample_values":["2","1","0"]},{"name":"SE_BRAND","sample_values":["SE Brand","Travelist"]},{"name":"SE_SALE_ID","sample_values":["106137","75486","3206"]},{"name":"SHIRO_USER_ID","sample_values":["13430332","9856191","65423270"]},{"name":"TRANSACTION_ID","sample_values":["A60593-30019-17558436","A5843-3460-668348","A40100-23265-6402845"]},{"name":"TRAVEL_TYPE","sample_values":["International","Domestic","Unknown"]}],"facts":[{"name":"BOOKERS","default_aggregation":6,"sample_values":["47427470","52994948","28976911"]},{"name":"GROSS_REVENUE_GBP_CONSTANT_CURRENCY","default_aggregation":1,"sample_values":["223.234700000","444.803500000","200.000000000"]},{"name":"MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY","default_aggregation":1}],"filters":[{"name":"LIVE_BOOKINGS","synonyms":["live bookings"],"description":"Filter to only live bookings","expr":"booking_status_type = ''live''"},{"name":"SE_BRAND_BOOKINGS","synonyms":["se brand"],"description":"Bookings that occurred in the SE Brand","expr":"se_brand = ''SE Brand''"}],"time_dimensions":[{"name":"BOOKING_COMPLETED_DATE","sample_values":["2017-02-28","2017-01-09"]},{"name":"BOOKING_COMPLETED_TIMESTAMP","sample_values":["2018-03-11T22:25:25.000+0000","2018-10-11T03:20:22.000+0000","2019-01-25T11:04:11.000+0000"]},{"name":"CHECK_IN_DATE","sample_values":["2013-10-03","2015-08-30","2022-04-05"]},{"name":"CHECK_OUT_DATE","sample_values":["2019-03-31","2018-05-08","2017-07-15"]}]},{"name":"SE_CALENDAR","facts":[{"name":"SE_WEEK","sample_values":["29","1","2"]},{"name":"SE_YEAR","sample_values":["1972","1971","1970"]}],"time_dimensions":[{"name":"DATE_VALUE","sample_values":["1970-04-09","1970-01-30","1970-01-02"]}]},{"name":"SE_USER_ATTRIBUTES","dimensions":[{"name":"ACQUISITION_PLATFORM","sample_values":["UNKNOWN","WEB","MOBILE_WEB"]},{"name":"APP_PUSH_OPT_IN_STATUS","sample_values":["opted in","opted out"]},{"name":"CURRENT_AFFILIATE_NAME","sample_values":["Secret Escapes IT","Unister generic","Google CPL Germany - Non-Brand (UK Campaign)"]},{"name":"EMAIL_OPT_IN_STATUS","sample_values":["daily","weekly","opted out"]},{"name":"HAS_APP_INSTALLED","sample_values":["TRUE","FALSE"]},{"name":"IS_TEST_USER","sample_values":["TRUE","FALSE"]},{"name":"MAIN_AFFILIATE_NAME","sample_values":["Secret Escapes ES","ES magazine","Secret Escapes IT"]},{"name":"MEMBERSHIP_ACCOUNT_STATUS","sample_values":["DEACTIVATED","FULL_ACCOUNT","DELETED"]},{"name":"ORIGINAL_AFFILIATE_NAME","sample_values":["facebook ads","PF2017 Smart","Secret Escapes SK"]}],"facts":[{"name":"SHIRO_USER_ID","sample_values":["35343862","39445427","30470101"]}],"filters":[{"name":"ACTIVE_ACCOUNTS","synonyms":["active user accounts","users with an active account"],"description":"Active user accounts","expr":"MEMBERSHIP_ACCOUNT_STATUS = ''FULL_ACCOUNT''"}],"time_dimensions":[{"name":"SIGNUP_TSTAMP","sample_values":["2016-07-08T20:21:41.000+0000","2018-10-03T13:19:36.000+0000","2025-04-14T18:24:50.000+0000"]}]}],"relationships":[{"name":"BOOKING_TO_SALE"},{"name":"BOOKING_TO_SE_CALENDAR"},{"name":"BOOKING_TO_USER"}],"verified_queries":[{"name":"show me live bookings to destination Germany yesterday","question":"Show me live bookings to destination Germany yesterday","sql":"SELECT\\n  fb.booking_id,\\n  fb.booking_completed_date,\\n  fb.shiro_user_id,\\n  fb.gross_revenue_gbp_constant_currency,\\n  fb.margin_gross_of_toms_gbp_constant_currency\\nFROM\\n  fact_complete_booking AS fb\\n  INNER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id\\nWHERE\\n  fb.booking_status_type = ''live''\\n  AND ds.posu_country = ''Germany''\\n  AND fb.booking_completed_date = CURRENT_DATE - INTERVAL ''1 DAY''\\nORDER BY\\n  fb.booking_completed_date DESC NULLS LAST","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763635738},{"name":"Show me live bookings for se brand per month for 2025","question":"Show me live bookings for se brand per month for 2025","sql":"SELECT\\n  DATE_TRUNC(''MONTH'', fb.booking_completed_date) AS month,\\n  COUNT(fb.booking_id) AS booking_count,\\n  SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_revenue_gbp\\nFROM\\n  fact_complete_booking AS fb\\nWHERE\\n  fb.booking_status_type = ''live''\\n  AND fb.se_brand = ''SE Brand''\\n  AND DATE_PART(''year'', fb.booking_completed_date) = 2025\\nGROUP BY\\n  DATE_TRUNC(''MONTH'', fb.booking_completed_date)\\nORDER BY\\n  month DESC NULLS LAST","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763635746},{"name":"give me a summary of bookings that were made on se brand yesterday","question":"give me a summary of bookings that were made on se brand yesterday","sql":"SELECT\\n  COUNT(fb.booking_id) AS booking_count,\\n  SUM(fb.gross_revenue_gbp_constant_currency) AS total_revenue_gbp,\\n  SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_margin_gbp\\nFROM\\n  fact_complete_booking AS fb\\nWHERE\\n  fb.se_brand = ''SE Brand''\\n  AND fb.booking_completed_date = CURRENT_DATE - INTERVAL ''1 DAY''","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763635811},{"name":"Compare se week 46 this year versus last year","question":"Compare se week 46 this year versus last year","sql":"WITH week_46_2025 AS (\\n  SELECT\\n    COUNT(fb.booking_id) AS booking_count,\\n    SUM(fb.gross_revenue_gbp_constant_currency) AS total_revenue_gbp,\\n    SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_margin_gbp\\n  FROM\\n    fact_complete_booking AS fb\\n    LEFT OUTER JOIN se_calendar AS cal ON fb.booking_completed_date = cal.date_value\\n  WHERE\\n    cal.se_week = 46\\n    AND cal.se_year = 2025\\n),\\nweek_46_2024 AS (\\n  SELECT\\n    COUNT(fb.booking_id) AS booking_count,\\n    SUM(fb.gross_revenue_gbp_constant_currency) AS total_revenue_gbp,\\n    SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_margin_gbp\\n  FROM\\n    fact_complete_booking AS fb\\n    LEFT OUTER JOIN se_calendar AS cal ON fb.booking_completed_date = cal.date_value\\n  WHERE\\n    cal.se_week = 46\\n    AND cal.se_year = 2024\\n)\\nSELECT\\n  2025 AS curr_year,\\n  2024 AS prev_year,\\n  curr.booking_count AS curr_booking_count,\\n  prev.booking_count AS prev_booking_count,\\n  curr.total_revenue_gbp AS curr_total_revenue_gbp,\\n  prev.total_revenue_gbp AS prev_total_revenue_gbp,\\n  curr.total_margin_gbp AS curr_total_margin_gbp,\\n  prev.total_margin_gbp AS prev_total_margin_gbp,\\n  curr.booking_count - prev.booking_count AS booking_count_yoy_chg,\\n  (curr.booking_count - prev.booking_count) / NULLIF(NULLIF(prev.booking_count, 0), 0) AS booking_count_yoy_pct_chg,\\n  curr.total_revenue_gbp - prev.total_revenue_gbp AS revenue_yoy_chg,\\n  (curr.total_revenue_gbp - prev.total_revenue_gbp) / NULLIF(NULLIF(prev.total_revenue_gbp, 0), 0) AS revenue_yoy_pct_chg,\\n  curr.total_margin_gbp - prev.total_margin_gbp AS margin_yoy_chg,\\n  (curr.total_margin_gbp - prev.total_margin_gbp) / NULLIF(NULLIF(prev.total_margin_gbp, 0), 0) AS margin_yoy_pct_chg\\nFROM\\n  week_46_2025 AS curr\\n  CROSS JOIN week_46_2024 AS prev","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763636020},{"name":"how many bookings did we make yesterday","question":"how many bookings did we make yesterday","sql":"SELECT\\n  COUNT(fb.booking_id) AS booking_count\\nFROM\\n  fact_complete_booking AS fb\\nWHERE\\n  fb.booking_completed_date = CURRENT_DATE - INTERVAL ''1 DAY''","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763656788},{"name":"create some buckets of 1, 2, 3 - 5, and 6+ bookers and show me how many people are in each bucket for bookings this year","question":"create some buckets of 1, 2, 3 - 5, and 6+ bookers and show me how many people are in each bucket for bookings this year","sql":"WITH user_bookings AS (\\n  SELECT\\n    sv.shiro_user_id,\\n    COUNT(*) AS booking_count\\n  FROM\\n    SEMANTIC_VIEW(\\n      SE.DATA.BOOKING_ANALYSIS FACTS fact_complete_booking.shiro_user_id\\n      WHERE\\n        DATE_PART(''YEAR'', booking_completed_date) = DATE_PART(''YEAR'', CURRENT_DATE)\\n        AND booking_status_type = ''live''\\n    ) AS sv\\n  GROUP BY\\n    sv.shiro_user_id\\n),\\nbooking_buckets AS (\\n  SELECT\\n    shiro_user_id,\\n    booking_count,\\n    CASE\\n      WHEN booking_count = 1 THEN ''1 booking''\\n      WHEN booking_count = 2 THEN ''2 bookings''\\n      WHEN booking_count BETWEEN 3\\n      AND 5 THEN ''3-5 bookings''\\n      WHEN booking_count >= 6 THEN ''6+ bookings''\\n    END AS booking_bucket\\n  FROM\\n    user_bookings\\n)\\nSELECT\\n  booking_bucket,\\n  COUNT(*) AS people_count\\nFROM\\n  booking_buckets\\nGROUP BY\\n  booking_bucket\\nORDER BY\\n  CASE\\n    booking_bucket\\n    WHEN ''1 booking'' THEN 1\\n    WHEN ''2 bookings'' THEN 2\\n    WHEN ''3-5 bookings'' THEN 3\\n    WHEN ''6+ bookings'' THEN 4\\n  END","use_as_onboarding_question":false,"verified_by":"robin patel","verified_at":1763657153}],"module_custom_instructions":{"sql_generation":"Unless asked not to, always apply the named filters SE_BRAND_BOOKINGS and LIVE_BOOKINGS"}}');
