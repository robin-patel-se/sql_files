SELECT *
FROM se.data.scv_touch_marketing_channel stmc
         INNER JOIN se.data.scv_touch_basic_attributes stba ON stmc.touch_id = stba.touch_id
WHERE stmc.referrer_hostname LIKE 'bit.ly'
  AND stba.touch_start_tstamp >= '2020-11-10';


CREATE OR REPLACE TABLE hygiene_snapshot_vault_mvp_dev_gianni.cms_mysql.booking CLONE hygiene_snapshot_vault_mvp.cms_mysql.booking;
CREATE OR REPLACE TABLE hygiene_snapshot_vault_mvp_dev_gianni.cms_mysql.reservation CLONE hygiene_snapshot_vault_mvp.cms_mysql.reservation;
CREATE OR REPLACE TABLE hygiene_snapshot_vault_mvp_dev_gianni.cms_mongodb.booking_summary CLONE hygiene_snapshot_vault_mvp.cms_mongodb.booking_summary;
CREATE OR REPLACE TABLE hygiene_snapshot_vault_mvp_dev_gianni.fpa_gsheets.constant_currency CLONE hygiene_snapshot_vault_mvp.fpa_gsheets.constant_currency;
CREATE OR REPLACE TABLE data_vault_mvp_dev_gianni.dwh.booking_cancellation CLONE data_vault_mvp.dwh.booking_cancellation;
CREATE OR REPLACE TABLE data_vault_mvp_dev_gianni.cms_mysql_snapshots.amendment_snapshot CLONE data_vault_mvp.cms_mysql_snapshots.amendment_snapshot;
CREATE OR REPLACE TABLE data_vault_mvp_dev_gianni.cms_mysql_snapshots.product_reservation_snapshot CLONE data_vault_mvp.cms_mysql_snapshots.product_reservation_snapshot;
CREATE OR REPLACE TABLE data_vault_mvp_dev_gianni.cms_mysql_snapshots.days_before_policy_snapshot CLONE data_vault_mvp.cms_mysql_snapshots.days_before_policy_snapshot;


SHOW TERSE TABLES IN SCHEMA data_vault_mvp.single_customer_view_stg_bak;

SELECT *
FROM data_vault_mvp.information_schema.tables
WHERE table_schema = 'SINGLE_CUSTOMER_VIEW_STG_BAK';

SELECT 'DROP TABLE ' || table_name || ';'     AS query,
       row_number() OVER (ORDER BY t.created) AS row_number
FROM data_vault_mvp.information_schema.tables t
WHERE t.table_schema = 'SINGLE_CUSTOMER_VIEW_STG_BAK'
  AND t.created::DATE < current_date - 7;


CREATE OR REPLACE TABLE data_vault_mvp_dev_robin.single_customer_view_stg.module_touch_basic_attributes CLONE data_vault_mvp.single_customer_view_stg.module_touch_basic_attributes;
CREATE OR REPLACE TABLE data_vault_mvp_dev_robin.single_customer_view_stg.module_touchification CLONE data_vault_mvp.single_customer_view_stg.module_touchification;
CREATE OR REPLACE TABLE hygiene_vault_mvp_dev_robin.snowplow.event_stream CLONE hygiene_vault_mvp.snowplow.event_stream;


SELECT 'DROP TABLE ' || table_name || ';' AS query
FROM data_vault_mvp_dev_robin.information_schema.tables t
WHERE LOWER(t.table_schema) = 'single_customer_view_stg_bak'
  AND t.table_name ILIKE 'module_touch_basic_attributes%';
--   AND t.created::DATE < current_date - 7;

SELECT *
FROM data_vault_mvp_dev_robin.information_schema.tables t
WHERE LOWER(t.table_schema) = 'single_customer_view_stg_bak'
AND t.table_name ILIKE 'module_touch_basic_attributes%'
;
CREATE SCHEMA data_vault_mvp_dev_robin.single_customer_view_stg_bak;

CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201104t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201104t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201105t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201105t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201106t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201106t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201107t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201107t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201108t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201108t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201109t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201109t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201110t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201110t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201111t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201111t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_attribution__20201112t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_attribution__20201112t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201104t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201104t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201105t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201105t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201106t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201106t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201107t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201107t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201108t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201108t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201109t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201109t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201110t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201110t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201111t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201111t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_basic_attributes__20201112t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_basic_attributes__20201112t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201104t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201104t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201105t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201105t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201106t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201106t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201107t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201107t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201108t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201108t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201109t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201109t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201110t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201110t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201111t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201111t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_marketing_channel__20201112t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_marketing_channel__20201112t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201104t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201104t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201105t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201105t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201106t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201106t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201107t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201107t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201108t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201108t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201109t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201109t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201110t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201110t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201111t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201111t030000__daily_at_03h00
CREATE OR REPLACE TRANSIENT TABLE data_vault_mvp_dev_robin.single_customer_view_stg_bak.module_touch_utm_referrer__20201112t030000__daily_at_03h00 CLONE data_vault_mvp.single_customer_view_stg_bak.module_touch_utm_referrer__20201112t030000__daily_at_03h00

self_describing_task --include 'dv/dwh/events/04_touch_basic_attributes/01_module_touch_basic_attributes.py'  --method 'run' --start '2020-11-12 00:00:00' --end '2020-11-12 00:00:00'

DROP SCHEMA data_vault_mvp_dev_robin.single_customer_view_stg_bak;