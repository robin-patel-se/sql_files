name: BOOKING_ANALYSIS
description: This dataset contains comprehensive information about travel booking transactions and sales data. You can analyse booking patterns, customer behaviour, revenue performance, and sales trends across different destinations, time periods, and customer segments. The data includes details about accommodations, flight bookings, customer demographics, booking lead times, revenue metrics, and geographic information. You can perform analysis on booking volumes, revenue trends, customer loyalty patterns, seasonal variations, and compare performance across different regions and time periods.
tables:
  - name: DIM_SALE
    synonyms:
      - sale
    description: This table, DIM_SALE, appears to be a dimension table in a data warehouse that stores information about sales data. It contains a wide range of attributes that describe a sale, including sale details, product information, supplier and partner data, sales performance metrics, customer feedback, and geographic location. The table seems to be used for analytics and reporting purposes, providing a comprehensive view of sales data to support business decision-making.
    base_table:
      database: SE
      schema: DATA
      table: DIM_SALE
    dimensions:
      - name: POSU_CITY
        synonyms:
          - destination
          - destination city
          - point of supply city
        description: The city where the point of sale is located.
        expr: POSU_CITY
        data_type: VARCHAR(16777216)
        sample_values:
          - London
          - Paris
          - Dubai
          - Berlin
          - Rome
          - Mallorca
          - Barcelona
          - Prague
          - Reykjavik
          - Vienna
          - Crete
          - Amsterdam
      - name: POSU_CLUSTER
        description: Point of Sale Usage Cluster, categorizing customers based on their purchase behavior and frequency, with 1 indicating high usage, 2 indicating medium usage, and Other indicating low or no usage.
        expr: POSU_CLUSTER
        data_type: VARCHAR(16777216)
        sample_values:
          - 2
          - 1
          - Other
          - 0
      - name: POSU_CLUSTER_REGION
        description: Geographic region where the point of sale is located, categorized into clusters for sales analysis and reporting purposes.
        expr: POSU_CLUSTER_REGION
        data_type: VARCHAR(16777216)
        sample_values:
          - Arctic
          - Norway
          - Croatia
          - AUNZ
          - Denmark
          - Romania
          - Bosnia And Herzegovina
          - Spain
          - Greece
          - Other Asia
          - Netherlands
          - France
          - Sweden
          - Poland
          - Austria
          - Caribbean
          - Middle East
          - Sub-Saharan Africa
          - Germany
          - Non-Balkan CEE
          - Slovenia
          - Albania
          - Cyprus
          - Portugal
          - Malta
          - Other
          - Switzerland (Italian speaking)
          - Switzerland (French speaking)
          - Macedonia
          - Turkey
          - Central America
          - Bulgaria
          - Indian Ocean
          - Ireland
          - North Africa
          - North America
          - Belgium
          - South East Asia
          - Montenegro
          - Serbia
          - South America
          - Pacific Islands
          - Switzerland
          - UK
          - Italy
      - name: POSU_CLUSTER_SUB_REGION
        description: Geographic sub-region where a point of sale is located, such as a province or island.
        expr: POSU_CLUSTER_SUB_REGION
        data_type: VARCHAR(16777216)
        sample_values:
          - Indonesia
          - Lazio
          - Crete
      - name: POSU_COUNTRY
        synonyms:
          - country
          - destination country
          - holiday country
          - nation
          - point of supply country
          - target country
          - travel country
          - trip country
          - visit country
        description: |
          The destination country where the booking is fulfilled. Indicates where customers  are traveling to for their hotel stay or vacation.
        expr: POSU_COUNTRY
        data_type: VARCHAR(16777216)
        sample_values:
          - Slovenia
          - Germany
          - Malaysia
      - name: POSU_REGION
        synonyms:
          - destination region
          - geographic region
          - location region
          - point of sale region
          - regional territory
        description: |
          Primary destination region categorization grouping locations into major market areas  like UK, Spain, France, DACH (Germany/Austria/Switzerland), CEE, Scandinavia, International.
        expr: POSU_REGION
        data_type: VARCHAR(16777216)
        sample_values:
          - France POSu
          - CEE POSu
          - Scandinavia POSu
          - DACH POSu
          - Italy POSu
          - Arctic POSu
          - International POSu
          - Asia POSu
          - Spain POSu
          - Other
          - UK POSu
          - US POSu
          - Poland POSu
          - BENELUX POSu
          - Ireland POSu
      - name: POSU_SUB_REGION
        synonyms:
          - area
          - destination sub region
          - local region
          - provincial region
          - regional area
        description: |
          Granular sub-regional classification within destination countries, identifying specific  geographic areas like London, South East England, Balearic Islands, or ALPS regions.
        expr: POSU_SUB_REGION
        data_type: VARCHAR(16777216)
        sample_values:
          - Other
          - South East Asia
          - London
          - ALPS
          - BENELUX-OTHER
          - Portugal
          - Croatia
          - Balearic Islands
          - South East
          - Sweden
          - United Arab Emirates
          - USA North East
          - Canary Islands
          - Midlands
          - South West
          - Trentino-Alto Adige
          - GERMANY-WEST
          - Ile-de-France
      - name: PRODUCT_CONFIGURATION
        synonyms:
          - booking method
          - configuration
          - distribution channel
          - offer type
          - product model
          - product type
          - sales channel
        description: |
          Distribution channel and product delivery model. Indicates how the product is sold:  Hotel (direct hotel bookings), Hotel Plus (enhanced offerings), 3PP (third-party providers),  WRD (wholesale rate desk), IHP (in-house products - static/dynamic/connected), Catalogue.
        expr: PRODUCT_CONFIGURATION
        data_type: VARCHAR(16777216)
        sample_values:
          - Hotel
          - Hotel Plus
          - 3PP
          - WRD
          - IHP - static
          - Catalogue
          - IHP - connected
          - IHP - dynamic
          - WRD - direct
          - N/A
      - name: PRODUCT_TYPE
        description: Categorization of the product or service being sold, indicating whether it is a Web Redirect (WRD), Hotel, Package, Day Experience, or an Unknown type.
        expr: PRODUCT_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - Hotel
          - Package
          - WRD
          - Day Experience
          - Unknown
          - Not Applicable
      - name: SALE_ACTIVE
        synonyms:
          - active sale
          - currently active
          - is active
          - sale live status
          - sale status
        description: |
          Boolean indicator of whether the sale/offer is currently active and bookable (TRUE)  or has been deactivated/ended (FALSE).
          Note that sales might currently be live or deactivated but this does not represent their active status at the time of booking. 
          Logically every sale was live at the time of a booking.
        expr: SALE_ACTIVE
        data_type: BOOLEAN
        sample_values:
          - 'TRUE'
          - 'FALSE'
      - name: SALE_NAME
        synonyms:
          - deal name
          - hotel name
          - offer name
          - offering name
          - product name
          - sale title
        description: |
          Descriptive name/title of the sale or accommodation offer. Provides human-readable  identification of the specific hotel property or package being offered.
        expr: SALE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - 'Hotell med havutsikt i Sanremo '
          - '5* Italian Riviera spa hotel '
          - 'Royal Hotel Sanremo '
      - name: SE_BRAND
        synonyms:
          - brand
          - brand name
          - business brand
          - company brand
          - platform
        description: |
          The SE Group brand through which the sale is marketed and sold. Primary brands  include "SE Brand" (Secret Escapes) and "Travelist".
        expr: SE_BRAND
        data_type: VARCHAR(16777216)
        sample_values:
          - SE Brand
          - Travelist
    time_dimensions:
      - name: SALE_START_DATE
        synonyms:
          - go live date
          - launch date
          - sale begin date
          - sale start
          - start date
        description: |
          Timestamp when the sale/offer was first made available for booking.
        expr: SALE_START_DATE
        data_type: TIMESTAMP_NTZ(9)
    primary_key:
      columns:
        - SE_SALE_ID
  - name: FACT_BOOKING
    synonyms:
      - bookings
      - orders
      - purchases
      - reservations
      - transactions
    description: |
      Core fact table containing all booking transactions with detailed information about  customers, travel dates, financial metrics, booking status, and booking history.  Central table for revenue analysis, customer behavior, and booking performance metrics.
    base_table:
      database: SE
      schema: DATA
      table: FACT_BOOKING
    dimensions:
      - name: ADULT_GUESTS
        synonyms:
          - adult count
          - adult passengers
          - adult travelers
          - adults
          - grown-ups
          - number of adults
        description: |
          Number of adult guests (typically 18+ years) included in the booking party.
        expr: ADULT_GUESTS
        data_type: NUMBER(38,0)
        sample_values:
          - '0'
          - '2'
          - '4'
      - name: BOOKER_LOYALTY_SEGMENT
        synonyms:
          - booking frequency segment
          - booking tier
          - customer loyalty
          - customer segment
          - customer tier
          - loyalty segment
          - loyalty tier
          - repeat customer segment
        description: |
          Customer loyalty segmentation based on lifetime booking count. Segments: First-Time Booker  (1st booking), Second-Time Booker (2nd booking), Regular Customer (3-5 bookings),  Frequent Customer (6-10 bookings), VIP Customer (10+ bookings). Critical for CLV analysis,  retention strategies, and loyalty program management.
        expr: |-
          CASE 
              WHEN live_booking_index = 1 THEN 'First-Time Booker'
              WHEN live_booking_index = 2 THEN 'Second-Time Booker'
              WHEN live_booking_index BETWEEN 3 AND 5 THEN 'Regular Customer (3-5 bookings)'
              WHEN live_booking_index BETWEEN 6 AND 10 THEN 'Frequent Customer (6-10 bookings)'
              WHEN live_booking_index > 10 THEN 'VIP Customer (10+ bookings)'
              ELSE 'Unknown'
          END
        data_type: VARCHAR(33)
        sample_values:
          - Unknown
          - Frequent Customer (6-10 bookings)
          - First-Time Booker
          - Regular Customer (3-5 bookings)
          - Second-Time Booker
          - VIP Customer (10+ bookings)
      - name: BOOKER_RECENCY_SEGMENT
        synonyms:
          - activity recency
          - booking recency bucket
          - customer recency
          - engagement recency
          - last booking recency
          - reactivation segment
          - recency segment
        description: |
          Customer engagement segmentation based on days since previous booking. Segments:  First Booking (no prior booking), Very Active (within 30 days), Active (1-3 months),  Moderate (3-6 months), Infrequent (6-12 months), Dormant (12+ months). Essential for  identifying at-risk customers and targeting reactivation campaigns.
        expr: |-
          CASE 
              WHEN days_since_previous_live_booking IS NULL THEN 'First Booking'
              WHEN days_since_previous_live_booking <= 30 THEN 'Very Active (Within month)'
              WHEN days_since_previous_live_booking > 30 AND days_since_previous_live_booking <= 90 THEN 'Active (1-3 months)'
              WHEN days_since_previous_live_booking > 90 AND days_since_previous_live_booking <= 180 THEN 'Moderate (3-6 months)'
              WHEN days_since_previous_live_booking > 180 AND days_since_previous_live_booking <= 365 THEN 'Infrequent (6-12 months)'
              WHEN days_since_previous_live_booking > 365 THEN 'Dormant (12+ months)'
              ELSE 'Unknown'
          END
        data_type: VARCHAR(26)
        sample_values:
          - First Booking
          - Infrequent (6-12 months)
          - Very Active (Within month)
          - Active (1-3 months)
          - Moderate (3-6 months)
          - Infrequent (6-12 months)
          - Dormant (12+ months)
      - name: BOOKING_ID
        synonyms:
          - booking identifier
          - booking number
          - order id
          - reservation id
          - transaction identifier
        description: |
          Unique identifier for each individual booking transaction. Primary key for the booking fact table.
        expr: BOOKING_ID
        data_type: VARCHAR(16777216)
      - name: BOOKING_INCLUDES_FLIGHT
        synonyms:
          - flight included
          - has flight
          - includes flight
          - with flight
        description: |
          Boolean flag indicating whether the booking includes flight arrangements (TRUE)  or is accommodation-only (FALSE).
        expr: BOOKING_INCLUDES_FLIGHT
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
          - 'TRUE'
      - name: BOOKING_LEAD_TIME_CATEGORY
        synonyms:
          - advance purchase window
          - advance_booking_category
          - advance_booking_segment
          - advance_purchase_category
          - booking window
          - booking_advance_category
          - booking_timing_category
          - booking_window_category
          - lead_time_classification
          - lead_time_group
          - planning window
          - reservation_lead_time_group
          - reservation_timing_group
        description: |
          Booking behavior segmentation based on advance booking window (days between booking  and check-in). Categories: Last Minute (0-7 days), Short Notice (8-30 days), Standard  (31-90 days), Early Booker (91-180 days), Super Early (180+ days), Invalid/Negative.  Enables pricing optimization, demand forecasting, and targeted marketing by planning horizon.
        expr: |-
          CASE 
              WHEN booking_lead_time_days < 0 THEN 'Invalid/Negative'
              WHEN booking_lead_time_days >= 0 AND booking_lead_time_days <= 7 THEN 'Last Minute (0-7 days)'
              WHEN booking_lead_time_days > 7 AND booking_lead_time_days <= 30 THEN 'Short Notice (8-30 days)'
              WHEN booking_lead_time_days > 30 AND booking_lead_time_days <= 90 THEN 'Standard (31-90 days)'
              WHEN booking_lead_time_days > 90 AND booking_lead_time_days <= 180 THEN 'Early Booker (91-180 days)'
              WHEN booking_lead_time_days > 180 THEN 'Super Early (180+ days)'
              ELSE 'Unknown'
          END
        data_type: VARCHAR(26)
        sample_values:
          - Standard (31-90 days)
          - Last Minute (0-7 days)
          - Short Notice (8-30 days)
          - Early Booker (91-180 days)
          - Super Early (180+ days)
      - name: BOOKING_LEAD_TIME_DAYS
        synonyms:
          - advance booking days
          - advance purchase days
          - booking window days
          - days in advance
          - lead time
          - planning days
        description: |
          Number of days between booking completion date and check-in date. Measures how far  in advance customers book their trips.
        expr: BOOKING_LEAD_TIME_DAYS
        data_type: NUMBER(38,0)
      - name: BOOKING_STATUS_TYPE
        synonyms:
          - booking state
          - booking status
          - order status
          - reservation status
          - status
          - transaction status
        description: |
          Current status of the booking transaction. Values: 'live' (active/confirmed),  'cancelled' (customer cancellation), 'abandoned' (started but not completed),  'other' (miscellaneous states).
        expr: BOOKING_STATUS_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - abandoned
          - cancelled
          - live
          - other
      - name: BOOKING_STATUS_TYPE_NET_IN_MONTH_CANCELLATIONS
        synonyms:
          - booking status net in month canx
          - net in month cancellations
          - net in month canx
        description: |
          The calculated status of bookings based on the booking_status_type field. Additional calculation of if the  booking_status_type is 'cancelled' but the cancellation date occurred in the same month of the booking_completed_date then call it 'live'.
        expr: IFF(booking_status_type = 'cancelled' AND DATE_TRUNC(MONTH, booking_completed_date) = DATE_TRUNC(MONTH, cancellation_date), 'live', booking_status_type)
        data_type: VARCHAR(16777216)
      - name: CHILD_GUESTS
        synonyms:
          - child count
          - child travelers
          - children
          - kids
          - number of children
          - young guests
        description: |
          Number of child guests (typically 2-17 years) included in the booking party.
        expr: CHILD_GUESTS
        data_type: NUMBER(38,0)
      - name: CURRENCY
        synonyms:
          - booking currency
          - currency code
          - payment currency
          - price currency
          - transaction currency
        description: |
          Currency in which the booking was transacted and priced (e.g., GBP, EUR, USD, SEK).
        expr: CURRENCY
        data_type: VARCHAR(16777216)
        sample_values:
          - EUR
          - GBP
          - SEK
          - PLN
          - USD
          - DKK
          - NOK
          - CHF
          - HUF
          - SGD
          - CZK
          - HKD
          - MYR
          - IDR
          - PHP
      - name: DAYS_SINCE_PREVIOUS_LIVE_BOOKING
        synonyms:
          - booking frequency days
          - booking gap
          - days since last booking
          - days since previous booking
          - rebooking interval
          - time between bookings
        description: |
          Number of days elapsed between this booking and the customer's previous live booking.  NULL for first-time bookers. Used for recency analysis and re-engagement targeting.
        expr: DAYS_SINCE_PREVIOUS_LIVE_BOOKING
        data_type: NUMBER(38,0)
      - name: DEVICE_PLATFORM
        synonyms:
          - access platform
          - booking channel
          - booking device
          - channel
          - device
          - device type
          - platform
        description: |
          Digital platform/device used to complete the booking. Values include: web (desktop browser),  mobile web, tablet web, native app ios, native app android, mobile wrap ios/android, call_centre.
        expr: DEVICE_PLATFORM
        data_type: VARCHAR(16777216)
        sample_values:
          - tablet web
          - mobile wrap ios
          - web
          - other
          - not specified
          - mobile wrap android
          - native app ios
          - mobile web
          - call_centre
          - native app android
          - Not Specified
      - name: INFANT_GUESTS
        synonyms:
          - babies
          - infant count
          - infant travelers
          - infants
          - number of infants
        description: |
          Number of infant guests (typically under 2 years old) included in the booking party.
        expr: INFANT_GUESTS
        data_type: NUMBER(38,0)
        sample_values:
          - '1'
          - '2'
          - '0'
      - name: LENGTH_OF_STAY_CATEGORY
        synonyms:
          - accommodation_period_category
          - duration segment
          - duration_classification
          - length_of_visit_category
          - lodging_length_category
          - nights_stayed_category
          - residence_duration_category
          - stay length
          - stay_duration_category
          - stay_period_category
          - trip length
          - trip_duration_category
          - visit_length_category
        description: |
          Trip duration segmentation based on number of nights. Categories: Weekend Break (1-2 nights),  Short Break (3-4 nights), Week Stay (5-7 nights), Extended Stay (8-14 nights), Long Stay  (15+ nights), Invalid. Helps identify travel pattern preferences and optimize property offerings.
        expr: |-
          CASE 
              WHEN no_nights <= 0 THEN 'Invalid'
              WHEN no_nights >= 1 AND no_nights <= 2 THEN 'Weekend Break (1-2 nights)'
              WHEN no_nights >= 3 AND no_nights <= 4 THEN 'Short Break (3-4 nights)'
              WHEN no_nights >= 5 AND no_nights <= 7 THEN 'Week Stay (5-7 nights)'
              WHEN no_nights >= 8 AND no_nights <= 14 THEN 'Extended Stay (8-14 nights)'
              WHEN no_nights > 14 THEN 'Long Stay (15+ nights)'
              ELSE 'Unknown'
          END
        data_type: VARCHAR(27)
        sample_values:
          - Unknown
          - Short Break (3-4 nights)
          - Weekend Break (1-2 nights)
          - Week Stay (5-7 nights)
          - Extended Stay (8-14 nights)
          - Long Stay (15+ nights)
      - name: LIVE_BOOKING_INDEX
        synonyms:
          - booking count
          - booking index
          - booking number
          - booking sequence
          - customer booking number
        description: |
          Sequential index of this booking in the customer's booking history. Values: 1 (first booking),  2 (second booking), 3+ (repeat bookings). Used for loyalty segmentation and customer lifecycle analysis.
        expr: LIVE_BOOKING_INDEX
        data_type: NUMBER(38,0)
      - name: PRICE_PER_NIGHT_CATEGORY
        synonyms:
          - cost category
          - luxury level
          - price category
          - price per night buckets
          - price segment
          - price tier
          - rate category
          - spend appetite
        description: |
          Price segmentation categories based on nightly rate. Segments: Budget (Under £100),  Standard (£100-£149), Mid-Range (£150-£249), Premium (£250-£399), Luxury (£400-£599),  Ultra-Luxury (£600+), Invalid/Error (£0 or less). Enables price-tier analysis and  customer spend behavior insights.
        expr: |-
          CASE 
              WHEN price_per_night <= 0 THEN 'Invalid/Error'
              WHEN price_per_night > 0 AND price_per_night < 100 THEN 'Budget (Under £100)'
              WHEN price_per_night >= 100 AND price_per_night < 150 THEN 'Standard (£100-£149)'
              WHEN price_per_night >= 150 AND price_per_night < 250 THEN 'Mid-Range (£150-£249)'
              WHEN price_per_night >= 250 AND price_per_night < 400 THEN 'Premium (£250-£399)'
              WHEN price_per_night >= 400 AND price_per_night < 600 THEN 'Luxury (£400-£599)'
              WHEN price_per_night >= 600 THEN 'Ultra-Luxury (£600+)'
              ELSE 'Unknown'
          END
        data_type: VARCHAR(21)
        sample_values:
          - Standard (£100-£149)
          - Mid-Range (£150-£249)
          - Unknown
          - Ultra-Luxury (£600+)
          - Luxury (£400-£599)
          - Budget (Under £100)
          - Premium (£250-£399)
      - name: SE_BRAND
        synonyms:
          - brand
          - business brand
          - company brand
          - platform
        description: |
          The SE Group brand platform where the booking was completed. Values: "SE Brand"  (Secret Escapes), "Travelist".
        expr: SE_BRAND
        data_type: VARCHAR(16777216)
        sample_values:
          - SE Brand
          - Travelist
      - name: SE_SALE_ID
        synonyms:
          - deal id
          - offer id
          - product id
          - sale id
        description: |
          Foreign key linking to the sale/offer that was booked. References DIM_SALE.SE_SALE_ID.
        expr: SE_SALE_ID
        data_type: VARCHAR(16777216)
        sample_values:
          - '106137'
          - '75486'
          - '3206'
      - name: SHIRO_USER_ID
        synonyms:
          - account id
          - booker id
          - customer id
          - member id
          - user id
        description: |
          Unique customer identifier linking to user profile and attributes. Foreign key to  SE_USER_ATTRIBUTES.SHIRO_USER_ID.
        expr: SHIRO_USER_ID
        data_type: NUMBER(38,0)
        sample_values:
          - '13430332'
          - '9856191'
          - '65423270'
      - name: TERRITORY
        synonyms:
          - area
          - district
          - geographic_area
          - market
          - market_area
          - posa territory
          - region
          - sales region
          - sales_territory
          - territory_code
          - zone
        description: |
          Sales territory or market where the booking originated (customer's location).  Examples: UK, DE (Germany), FR (France), US
        expr: TERRITORY
        data_type: VARCHAR(16777216)
      - name: TRANSACTION_ID
        synonyms:
          - payment id
          - payment reference
          - transaction identifier
          - transaction reference
        description: |
          Unique transaction reference identifier for the booking payment as known by the customer.
        expr: TRANSACTION_ID
        data_type: VARCHAR(33554433)
        sample_values:
          - A60593-30019-17558436
          - A5843-3460-668348
          - A40100-23265-6402845
      - name: TRAVEL_PARTY_TYPE
        synonyms:
          - family size
          - group size
          - group type
          - guest type
          - party composition
          - travel party
          - traveler type
        description: |
          Travel party composition classification based on guest demographics. Categories:  Solo Traveller (1 adult), Couple (2 adults), Group (Adults Only) (3+ adults),  Family with 1 Child, Family with Children, Invalid/Error, Other. Enables personalized  marketing and product recommendations.
        expr: |-
          CASE 
              WHEN adult_guests = 1 AND child_guests = 0 AND infant_guests = 0 THEN 'Solo Traveller'
              WHEN adult_guests = 2 AND child_guests = 0 AND infant_guests = 0 THEN 'Couple'
              WHEN adult_guests >= 3 AND child_guests = 0 AND infant_guests = 0 THEN 'Group (Adults Only)'
              WHEN adult_guests >= 1 AND (child_guests + infant_guests = 1) THEN 'Family with 1 Child'
                  WHEN adult_guests >= 1 AND (child_guests + infant_guests >= 1) THEN 'Family with Children'
              WHEN adult_guests = 0 THEN 'Invalid/Error'
              ELSE 'Other'
          END
        data_type: VARCHAR(20)
        sample_values:
          - Couple
          - Solo Traveller
          - Group (Adults Only)
          - Family with 1 Child
          - Family with Children
      - name: TRAVEL_TYPE
        synonyms:
          - booking type
          - domestic vs international
          - journey type
          - trip type
        description: |
          Classification of booking as Domestic (within customer's home country), International  (to another country), or Unknown.
        expr: TRAVEL_TYPE
        data_type: VARCHAR(50331648)
        sample_values:
          - International
          - Domestic
          - Unknown
    time_dimensions:
      - name: BOOKING_COMPLETED_DATE
        synonyms:
          - booking date
          - booking day
          - completion date
          - order date
          - purchase date
          - transaction date
        description: |
          Date when the booking transaction was successfully completed and confirmed.
        expr: BOOKING_COMPLETED_DATE
        data_type: DATE
        sample_values:
          - '2017-02-28'
          - '2017-01-09'
      - name: BOOKING_COMPLETED_TIMESTAMP
        synonyms:
          - booking time
          - booking timestamp
          - completion timestamp
          - purchase timestamp
          - transaction timestamp
        description: |
          Full timestamp (date and time) when the booking was completed.
        expr: BOOKING_COMPLETED_TIMESTAMP
        data_type: TIMESTAMP_NTZ(9)
        sample_values:
          - 2018-03-11T22:25:25.000+0000
          - 2018-10-11T03:20:22.000+0000
          - 2019-01-25T11:04:11.000+0000
      - name: CANCELLATION_DATE
        synonyms:
          - cancel date
          - cancellation date
          - cancellation timestamp
          - canx date
          - date cancelled
        description: |
          Date and time when the booking was cancelled by the customer or system.
        expr: CANCELLATION_DATE
        data_type: TIMESTAMP_NTZ(9)
      - name: CHECK_IN_DATE
        synonyms:
          - arrival date
          - holiday date
          - start date
          - stay start
          - travel date
          - trip start
          - visit date
        description: |
          Date when the guest checks in and begins their hotel stay.
        expr: CHECK_IN_DATE
        data_type: DATE
        sample_values:
          - '2013-10-03'
          - '2015-08-30'
          - '2022-04-05'
      - name: CHECK_OUT_DATE
        synonyms:
          - departure date
          - end date
          - holiday end date
          - leave date
          - return date
          - trip end
          - visit end date
        description: |
          Date when the guest checks out and ends their hotel stay.
        expr: CHECK_OUT_DATE
        data_type: DATE
        sample_values:
          - '2019-03-31'
          - '2018-05-08'
          - '2017-07-15'
    facts:
      - name: BOOKERS
        synonyms:
          - bookers
          - customers
          - unique bookers
          - unique customers
          - users
        description: |
          Metric counting unique customers/bookers. Use for customer count analysis.
        expr: SHIRO_USER_ID
        data_type: NUMBER(38,0)
        access_modifier: public_access
        default_aggregation: 6
        sample_values:
          - '47427470'
          - '52994948'
          - '28976911'
      - name: GROSS_REVENUE_GBP_CONSTANT_CURRENCY
        synonyms:
          - constant currency revenue
          - gross revenue
          - income
          - revenue
          - sales
          - total revenue
          - turnover
        description: |
          Total booking revenue in GBP using constant currency exchange rates for accurate  year-over-year comparisons. Represents gross customer payment before costs.
        expr: GROSS_REVENUE_GBP_CONSTANT_CURRENCY
        data_type: NUMBER(22,9)
        access_modifier: public_access
        default_aggregation: 1
        sample_values:
          - '223.234700000'
          - '444.803500000'
          - '200.000000000'
      - name: MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY
        synonyms:
          - constant currency gross margin gbp
          - constant gbp gross profit
          - fixed gbp gross profit margin
          - gross margin
          - gross margin constant gbp
          - gross profit
          - margin
          - profit
          - toms gross margin gbp fixed currency
        description: |
          Gross margin/profit in GBP using constant currency rates. Represents revenue minus  cost of goods sold (TOMS - Tour Operator Margin Scheme costs).
        expr: MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY
        data_type: NUMBER(22,9)
        access_modifier: public_access
        default_aggregation: 1
      - name: NO_NIGHTS
        synonyms:
          - duration
          - length of stay
          - night count
          - nights
          - number of nights
          - stay duration
        description: |
          Total number of nights the guest stayed at the accommodation.
        expr: NO_NIGHTS
        data_type: NUMBER(38,0)
        access_modifier: public_access
        sample_values:
          - '2'
          - '15'
      - name: PRICE_PER_NIGHT
        synonyms:
          - average nightly price
          - night rate
          - nightly cost
          - nightly rate
          - per night price
          - rate per night
        description: |
          Average price per night for the booking calculated as total price divided by number of nights.
        expr: PRICE_PER_NIGHT
        data_type: NUMBER(26,12)
        access_modifier: public_access
        sample_values:
          - '188.133800000000'
          - '407.899500000000'
          - '189.000000000000'
      - name: ROOMS
        synonyms:
          - number of rooms
          - room count
          - room quantity
          - rooms booked
        description: |
          Number of hotel rooms booked in this transaction.
        expr: ROOMS
        data_type: NUMBER(38,0)
        access_modifier: public_access
        sample_values:
          - '2'
          - '1'
          - '0'
    filters:
      - name: CURRENT_YEAR_BOOKINGS
        synonyms:
          - bookings this year
          - bookings this year so far
          - current year bookings
        description: Filters for bookings completed in the year 2026. Use when questions ask about 'this year', 'current year', '2026 bookings', 'bookings this year', or 'year-to-date performance'. Helps analyze current year performance, compare against previous years, and track annual business metrics and trends.
        expr: DATE_PART('year', booking_completed_date) = DATE_PART('year', CURRENT_DATE)
      - name: DOMESTIC_BOOKINGS
        synonyms:
          - domestic_orders
          - domestic_reservations
          - domestic_travel_bookings
          - home_country_bookings
          - internal_bookings
          - local_bookings
          - local_reservations
          - national_bookings
          - national_reservations
          - within_country_bookings
        description: Bookings that do not require international country travel. eg. UK user books UK
        expr: TRAVEL_TYPE = 'Domestic'
      - name: GROSS_BOOKINGS
        synonyms:
          - cancellation_analysis
          - canx_rate_filter
          - live_cancelled_only
        description: Use on bookings to include only live or cancelled bookings for cancellation rate calculations.
        expr: booking_status_type IN ('live', 'cancelled')
      - name: INTERNATIONAL_BOOKINGS
        synonyms:
          - abroad_bookings
          - cross_border_bookings
          - external_bookings
          - foreign_bookings
          - global_bookings
          - intercountry_bookings
          - offshore_bookings
          - overseas_bookings
          - transnational_bookings
          - worldwide_bookings
        description: Bookings that require international country travel. eg. UK user books Spain
        expr: TRAVEL_TYPE = 'International'
      - name: LIVE_BOOKINGS
        synonyms:
          - active bookings
          - confirmed bookings
          - live bookings
          - valid bookings
        description: |
          Filter expression to select only live/confirmed bookings. Excludes cancelled,  abandoned, and other status bookings.
        expr: booking_status_type = 'live'
      - name: LIVE_BOOKINGS_NET_IN_MONTH_CANCELLATIONS
        synonyms:
          - live bookings net in month canx
          - net in month cancelled bookings
          - net in month canx bookings
        description: Bookings that are current live or were cancelled in the same month as they were booked.
        expr: BOOKING_STATUS_TYPE_NET_IN_MONTH_CANCELLATIONS = 'live'
      - name: REPEAT_BOOKERS
        synonyms:
          - loyal_bookers
          - multi_booking_users
          - returning_customers
        description: Use on bookings to include only customers who have made multiple bookings (booking index 2 or higher).
        expr: live_booking_index >= 2
      - name: SE_BRAND_BOOKINGS
        synonyms:
          - se brand
          - se brand filter
          - secret escapes bookings
        description: |
          Filter expression to select only bookings made through the SE Brand (Secret Escapes)  platform, excluding Travelist and other brands.
        expr: se_brand = 'SE Brand'
      - name: SE_BRAND_BOOKINGS_ALL_STATUS
        synonyms:
          - all_status_se_brand
          - se_brand_all_status
          - se_brand_comprehensive
        description: Use on bookings to include only SE Brand bookings across all booking status types for comprehensive status analysis.
        expr: se_brand = 'SE Brand'
    metrics:
      - name: ALOS
        synonyms:
          - average_length_of_stay
          - average_stay_period
          - average_visit_duration
          - avg_los
          - avg_stay_length
          - length_of_stay_average
          - mean_length_of_stay
          - mean_stay_duration
          - stay_duration_avg
          - stay_length_average
        description: Average length of stay. This is the average of the number of nights for a booking.
        expr: AVG(NO_NIGHTS)
        access_modifier: public_access
      - name: AOV
        synonyms:
          - average_basket_value
          - average_order_value
          - average_purchase_amount
          - average_transaction_amount
          - avg_order_amount
          - avg_transaction_value
          - mean_order_value
          - mean_purchase_value
          - mean_transaction_size
          - order_value_average
        description: The average order value. This is averaging the Average gross revenue GBP.
        expr: AVG(GROSS_REVENUE_GBP_CONSTANT_CURRENCY)
        access_modifier: public_access
      - name: AVERAGE_LEAD_TIME_DAYS
        synonyms:
          - avg_lead_time_days
          - common_lead_time_days
          - expected_lead_time_days
          - mean_lead_time_days
          - median_lead_time_days
          - normal_lead_time_days
          - regular_lead_time_days
          - standard_lead_time_days
          - typical_lead_time_days
          - usual_lead_time_days
        description: The average lead time in days
        expr: AVG(BOOKING_LEAD_TIME_DAYS)
        access_modifier: public_access
      - name: AVERAGE_PPN
        synonyms:
          - average_nightly_rate
          - average_price_nightly
          - avg_night_cost
          - avg_night_rate
          - avg_price_per_night
          - mean_nightly_price
          - mean_ppn
          - mean_price_per_night
        description: Average price per night
        expr: AVG(PRICE_PER_NIGHT)
        access_modifier: public_access
      - name: BOOKING_COUNT
        synonyms:
          - booking_volume
          - total_bookings
        description: Total number of bookings made. Apply for volume analysis, destination popularity tracking, and operational capacity planning to understand booking trends and customer demand patterns across different markets and time periods.
        expr: COUNT(DISTINCT fact_booking.booking_id)
        access_modifier: public_access
      - name: CANCELLATION_RATE
        synonyms:
          - cancel rate
          - cancellation percentage
          - canx rate
          - churn rate
        description: |
          Calculated metric: percentage of bookings cancelled. Formula: COUNT(cancelled bookings) /  COUNT(live + cancelled bookings). Excludes abandoned and other status types.
        expr: COUNT_IF(BOOKING_STATUS_TYPE = 'cancelled') / COUNT_IF(BOOKING_STATUS_TYPE IN ('live', 'cancelled'))
        access_modifier: public_access
      - name: REPEAT_BOOKING_RATE
        synonyms:
          - booking_recurrence_rate
          - customer_loyalty_rate
          - customer_retention_rate
          - rebooking_percentage
          - rebooking_rate
          - recurring_booking_percentage
          - repeat_customer_percentage
          - repeat_purchase_rate
          - return_booking_frequency
          - return_customer_rate
        description: Rate of bookings that are from customers who have previously made a booking with us.
        expr: COUNT_IF(LIVE_BOOKING_INDEX > 1) / COUNT(*)
        access_modifier: public_access
  - name: SE_CALENDAR
    synonyms:
      - calendar
      - date dimension
      - date table
      - dates
      - time dimension
    description: |
      Date dimension table providing comprehensive calendar attributes for time-based analysis.  Includes year, week, date values and enables period comparisons, YTD/QTD/MTD calculations,  and date-based filtering across all fact tables.
    base_table:
      database: SE
      schema: DATA
      table: SE_CALENDAR
    dimensions:
      - name: IS_CURRENT_MONTH
        synonyms:
          - active_month_flag
          - current_month_boolean
          - current_month_flag
          - current_month_indicator
          - is_active_month
          - is_present_month
          - is_this_month
          - month_current_flag
          - present_month_indicator
          - this_month_flag
        description: whether the booking occurred within the current month
        expr: MONTH(DATE_VALUE) = MONTH(CURRENT_DATE) AND SE_YEAR = YEAR(CURRENT_DATE)
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
          - 'TRUE'
      - name: IS_CURRENT_WEEK
        synonyms:
          - active_week
          - current_week_boolean
          - current_week_flag
          - current_week_marker
          - is_present_week
          - is_this_week
          - present_week
          - this_week_indicator
          - week_current_flag
          - week_is_current
        description: whether the booking occurred within the current week
        expr: SE_WEEK = WEEK(CURRENT_DATE) AND SE_YEAR = YEAR(CURRENT_DATE)
        data_type: BOOLEAN
        sample_values:
          - 'FALSE'
          - 'TRUE'
      - name: MONTH_NAME
        synonyms:
          - calendar_month_name
          - full_month_name
          - month_description
          - month_descriptor
          - month_label
          - month_string
          - month_text
          - month_title
          - monthly_name
          - textual_month
        description: The abbreviated name of the month.
        expr: MONTHNAME(DATE_VALUE)
        data_type: VARCHAR(3)
        sample_values:
          - Mar
          - Apr
          - Feb
      - name: SE_WEEK
        synonyms:
          - calendar week
          - week
          - week number
          - week of year
        description: |
          Week number within the year (1-52). Week 1 is the first week of the calendar year,  week 52 is the last week. Used for weekly aggregation and week-over-week analysis.
        expr: SE_WEEK
        data_type: NUMBER(2,0)
        sample_values:
          - '29'
          - '1'
          - '2'
      - name: SE_YEAR
        synonyms:
          - calendar year
          - year
          - year number
        description: |
          Calendar year (e.g., 2024, 2025, 2026). Used for yearly aggregation and  year-over-year comparisons.
        expr: SE_YEAR
        data_type: NUMBER(5,0)
        sample_values:
          - '1972'
          - '1971'
          - '1970'
    time_dimensions:
      - name: DATE_VALUE
        synonyms:
          - calendar date
          - date
          - day
          - full date
        description: |
          Full calendar date value. Primary key for joining to date fields in fact tables  like booking_completed_date.
        expr: DATE_VALUE
        data_type: DATE
        sample_values:
          - '1970-04-09'
          - '1970-01-30'
          - '1970-01-02'
    primary_key:
      columns:
        - DATE_VALUE
  - name: SE_USER_ATTRIBUTES
    synonyms:
      - customer attributes
      - customers
      - members
      - user profiles
      - users
    description: |
      Customer/user dimension table containing user demographics, acquisition information,  marketing preferences, account status, and engagement attributes. Enables customer  segmentation, cohort analysis, and attribution reporting.
    base_table:
      database: SE
      schema: DATA
      table: SE_USER_ATTRIBUTES
    dimensions:
      - name: ACQUISITION_PLATFORM
        synonyms:
          - acquisition channel
          - join platform
          - registration platform
          - signup device
          - signup platform
        description: |
          Digital platform/device used by the customer during initial registration/signup.  Values: WEB, MOBILE_WEB, TABLET_WEB, IOS_APP_V3, ANDROID_APP_V3, MOBILE_WRAP_IOS/ANDROID.
        expr: ACQUISITION_PLATFORM
        data_type: VARCHAR(16777216)
        sample_values:
          - MOBILE_WEB
          - WEB
          - TABLET_WEB
          - IOS_APP_V3
          - MOBILE_WRAP_IOS
          - ANDROID_APP_V3
          - ANDROID_APP
          - IOS_APP
          - MOBILE_WRAP_ANDROID
      - name: APP_PUSH_OPT_IN_STATUS
        synonyms:
          - app notifications
          - notification preference
          - push notification status
          - push opt in
        description: |
          Customer's mobile app push notification preference. Values: "opted in" (receives  push notifications), "opted out" (does not receive push notifications).
        expr: APP_PUSH_OPT_IN_STATUS
        data_type: VARCHAR(16777216)
        sample_values:
          - opted in
          - opted out
      - name: CURRENT_AFFILIATE_NAME
        synonyms:
          - affiliate
          - affiliate source
          - current affiliate
          - current partner
          - partner
        description: |
          The most recent affiliate or marketing partner associated with the customer account.  Indicates the latest source of customer engagement (e.g., Google PPC, Facebook Ads,  specific SE market affiliates).
        expr: CURRENT_AFFILIATE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - ES magazine
          - google PPC
          - Google PPC Brand Sign-ups
          - Secret Escapes DE
          - Google CPL Germany - Brand
          - LateLuxury
          - ASAP by ShermansTravel
          - Google CPL Germany - Non-Brand
          - Secret Escapes US
          - google UK PPC CPL 2
          - Secret Escapes IT
          - Jetsetter Escapes
          - PF2015 Smart
          - Google CPL Italy - Non Brand
          - Google CPL Italy - Brand
          - TravelBird NL
          - PF2014 Smart
          - PF2017 Smart
          - PF 2016 Smart
          - Facebook Ads UK Mobile & Desktop
          - TravelBird BE-NL
          - Google CPL France - Non Brand
          - MyCity Venue - White Label
          - Google UK CPL - Non Brand
          - Google DE CPL - Brand
          - Facebook Ads USA Mobile
          - PF2013 Smart
          - Secret Escapes DE for v3 mobile apps
          - Google DE CPL - Non Brand
          - Google CPL USA - Non-Brand
          - Secret Escapes HU
          - Pigsback
          - Google UK CPL - Brand
          - Google CPL Netherlands - Non-Brand
          - TravelBird BE-FR
          - Society 19 Travel
          - TravelBird AT
          - google UK PPC CPL 3
          - Facebook Mobile Ads Italy NEW
          - facebook ads mobile
          - Secret Escapes NL
          - Yahoo PPC
          - facebook ads
          - Secret Escapes FR
          - Facebook Ads DE Mobile & Desktop
          - Secret Escapes SE
          - Google CPL Netherlands - Brand
          - Gilt
          - Facebook Ads IT Mobile & Dekstop
          - ES magazine for v3 mobile apps
          - Travista
          - Secret Escapes ES
          - PF2012 Smart
          - PF 2018 Smart
          - Yahoo Brand PPC
          - Fathom Escapes
          - Facebook Ads FR Mobile & Desktop
          - Unister Sale
          - Google CPL Spain - Non Brand
          - Google CPL Sweden - Non-Brand
          - Oyster Flash Sales
          - Secret Escapes IT for v3 mobile apps
          - Facebook Ads Germany Mobile
          - Google CPL Belgium - Non-Brand
          - Secret Escapes SK
          - Facebook Lead Ads DE
          - TravelBird SE
          - TravelBird FR
          - Google CPL brand Austria
          - Facebook Ads USA
          - Facebook Mobile Ads Spain NEW
          - Facebook Ads Netherlands Mobile
          - Facebook Mobile Ads France
          - Secret Escapes CZ
          - Facebook Ads Germany
          - TravelBird DK
          - Secret Escapes BE
          - Google CPL France - Brand
          - Unister generic
          - Digital window
          - Facebook Ads NL Mobile & Desktop
          - Facebook Mobile Ads Italy
          - Google CPL Sweden - Brand
          - Google CPL Spain - Brand
          - TravelBird DE
          - Facebook Mobile Ads Spain
          - Google CPL USA - Non-Brand EC
          - Bing Yahoo CPL non-Brand USA
          - Google CPL Germany - Non-Brand - Account 2 Hotel
          - Google CPL Denmark - Non-Brand
          - Secret Escapes DE for mobile apps
          - Tre Kronor Display
          - Payclick IT
          - Secret Escapes ID
          - Secret Escapes DK
          - Google GDN Germany
          - TravelHotelCard 3V Visa SOI
          - Secret Escapes CH
          - Google CPL Germany - Non-Brand - Account 3 Holiday
          - Google CPL Belgium - Brand
          - Bing Yahoo CPL Brand German
          - Leverate Native
          - facebook page
          - Facebook Ads Sweden Mobile
          - google UK PPC CPL 4
          - Secret Escapes NO
          - Secret Escapes IE
          - ES magazine for mobile apps
          - SweepsJan2018
          - Google CPA Campaign
          - Secret Escapes IT for mobile apps
          - Google CPL brand Switzerland
          - GDN IT
          - Google CPL non-brand Austria
          - Bing Yahoo CPL non-Brand German
          - GDN UK
          - Leonardo IT
          - Travelfinder (SE)
          - DC
          - TravelBird FI
          - Outbrain DE
          - Facebook Ads Denmark Mobile
          - Secret Escapes DE for mobile wrap
          - Telegraph Travel Other
          - MyCityVenue
          - Google CPL Norway - Non-Brand
          - Taboola DE
          - PS_DE_CPL_SE_Urlaubsguru_Calendar
          - Telegraph Travel Hand-picked
          - Google IT CPL - Brand
          - GDN USA
          - Guardian Escapes Base
          - Facebook Ads Netherlands
          - Google CPL USA - Non-Brand FL
          - Facebook Ads ES Mobile & Desktop
          - Facebook Ads Sweden
          - Google CPL Denmark - Brand
          - PF2015 Luxury
          - Google CPL USA - Brand
          - Facebook Ads IT Competitors Targeting
          - Unister generic - mobile - Germany
          - Facebook Ads BE Mobile & Desktop
          - Facebook Ads SE Mobile & Desktop
          - Facebook Ads France
          - Facebook Ads Norway Mobile
          - Guardian Escapes
          - DC9
          - PF2017 Luxury
      - name: EMAIL_OPT_IN_STATUS
        synonyms:
          - email frequency
          - email opt in
          - email preference
          - email subscription
          - newsletter preference
        description: |
          Customer's email communication preference. Values: "daily" (daily emails), "weekly"  (weekly digest), "opted out" (no marketing emails).
        expr: EMAIL_OPT_IN_STATUS
        data_type: VARCHAR(16777216)
        sample_values:
          - daily
          - weekly
          - opted out
      - name: HAS_APP_INSTALLED
        synonyms:
          - app installed
          - app user
          - has mobile app
          - mobile app user
        description: |
          Boolean indicator whether the customer has installed the mobile app (TRUE) or  has not (FALSE).
        expr: HAS_APP_INSTALLED
        data_type: BOOLEAN
        sample_values:
          - 'TRUE'
          - 'FALSE'
      - name: IS_TEST_USER
        synonyms:
          - internal user
          - test account
          - test flag
          - test user
        description: |
          Boolean flag indicating whether this is a test/internal user account (TRUE) or  a real customer (FALSE).
        expr: IS_TEST_USER
        data_type: BOOLEAN
        sample_values:
          - 'TRUE'
          - 'FALSE'
      - name: MAIN_AFFILIATE_NAME
        synonyms:
          - main affiliate
          - main partner
          - primary affiliate
          - primary partner
          - primary source
        description: |
          The primary/main affiliate or brand through which the customer primarily engages.  Typically represents the main Secret Escapes market or publication (e.g., Secret  Escapes DE, Secret Escapes UK, ES magazine, Guardian Escapes).
        expr: MAIN_AFFILIATE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - ES magazine
          - Secret Escapes DE
          - Secret Escapes US
          - Secret Escapes IT
          - Secret Escapes FR
          - Secret Escapes NL
          - Secret Escapes ES
          - Secret Escapes SE
          - Secret Escapes BE
          - TravelBird NL
          - Secret Escapes DK
          - TravelBird BE-NL
          - Secret Escapes NO
          - Secret Escapes HU
          - Secret Escapes CH
          - Pigsback
          - TravelBird BE-FR
          - Society 19 Travel
          - TravelBird AT
          - Telegraph Travel Hand-picked
          - Gilt
          - Secret Escapes SK
          - TravelBird SE
          - TravelBird FR
          - Secret Escapes CZ
          - Guardian Escapes
          - TravelBird DK
          - Secret Escapes ID
          - TravelBird DE
          - TravelHotelCard
          - Secret Escapes SG
          - Secret Escapes IE
          - Time Out
          - TravelBird FI
          - Secret Escapes MY
          - TravelBird NO
          - Secret Escapes HK
          - Teletext Holidays
          - TravelBird CH
          - Roomer Luxury
          - MailEscapes UK
          - Secret Escapes on Windows
          - Icelolly Escapes
          - Secret Escapes DE - www.urlaubsgeheimnis.com
          - Bunte Reisewelt
          - GALA
          - Hello! Escapes
          - Main Applitools Affiliate
          - Secret Escapes PH
          - PS_BE_RS_PA_SheDeals_Open Site
          - Holiday Pirates
          - Campadre
          - Travelist
          - Mail Escapes US
          - TravelBird UK
          - Hallam FM Escapes
          - Pink News US
          - Mighty Deals Travel
          - PS_NL_RS_PA_Holiday Pirates_Open Site
          - PS_FR_RS_PA_Holiday Pirates_Open Site
          - Design test
      - name: MEMBERSHIP_ACCOUNT_STATUS
        synonyms:
          - account state
          - account status
          - membership status
          - profile status
          - user status
        description: |
          Current status of the customer's membership account. Values: FULL_ACCOUNT (active),  DEACTIVATED (temporarily disabled), DELETED (permanently removed), BLOCKED (restricted),  UNSUBSCRIBED (opted out), PENDING (awaiting activation).
        expr: MEMBERSHIP_ACCOUNT_STATUS
        data_type: VARCHAR(16777216)
        sample_values:
          - DELETED
          - FULL_ACCOUNT
          - BLOCKED
          - DEACTIVATED
          - UNSUBSCRIBED
          - PENDING
      - name: ORIGINAL_AFFILIATE_NAME
        synonyms:
          - acquisition affiliate
          - first affiliate
          - first source
          - original affiliate
          - original source
          - signup affiliate
        description: |
          The original affiliate/marketing source that first referred the customer to Secret  Escapes during initial signup. Never changes after account creation. Used for  acquisition attribution analysis.
        expr: ORIGINAL_AFFILIATE_NAME
        data_type: VARCHAR(16777216)
        sample_values:
          - ES magazine
          - google PPC
          - LateLuxury
          - Google PPC Brand Sign-ups
          - Secret Escapes DE
          - Google CPL Germany - Brand
          - ASAP by ShermansTravel
          - Google CPL Germany - Non-Brand
          - google UK PPC CPL 2
          - Secret Escapes IT
          - HotelsOne
          - Jetsetter Escapes
          - PF2015 Smart
          - Google CPL Italy - Non Brand
          - Google CPL Italy - Brand
          - TravelBird NL
          - PF2014 Smart
          - PF2017 Smart
          - PF 2016 Smart
          - TravelBird BE-NL
          - Google CPL France - Non Brand
          - MyCity Venue - White Label
          - Google UK CPL - Non Brand
          - Facebook Ads UK Mobile & Desktop
          - Google DE CPL - Brand
          - Facebook Ads USA Mobile
          - PF2013 Smart
          - Secret Escapes DE for v3 mobile apps
          - Google DE CPL - Non Brand
          - Google CPL USA - Non-Brand
          - Luxury Link Escapes
          - Secret Escapes HU
          - Google UK CPL - Brand
          - Pigsback
          - Google CPL Netherlands - Non-Brand
          - TravelBird BE-FR
          - Society 19 Travel
          - Secret Escapes US
          - Facebook Mobile Ads Italy NEW
          - TravelBird AT
          - google UK PPC CPL 3
          - facebook ads
          - facebook ads mobile
          - Secret Escapes NL
          - Yahoo PPC
          - Secret Escapes FR
          - Google CPL Netherlands - Brand
          - Secret Escapes SE
          - Gilt
          - Facebook Ads DE Mobile & Desktop
          - ES magazine for v3 mobile apps
          - Travista
          - PF2012 Smart
          - Facebook Ads IT Mobile & Dekstop
          - Secret Escapes ES
          - PF 2018 Smart
          - Yahoo Brand PPC
          - Fathom Escapes
          - Unister Sale
          - Google CPL Spain - Non Brand
          - Google CPL Sweden - Non-Brand
          - Facebook Ads FR Mobile & Desktop
          - Oyster Flash Sales
          - Secret Escapes IT for v3 mobile apps
          - Facebook Ads Germany Mobile
          - Facebook Ads Germany
          - Vacationist
          - Secret Escapes SK
          - Google CPL Belgium - Non-Brand
          - Facebook Lead Ads DE
          - TravelBird SE
          - TravelBird FR
          - Facebook Ads USA
          - Google CPL brand Austria
          - Facebook Mobile Ads Spain NEW
          - Facebook Ads Netherlands Mobile
          - Secret Escapes CZ
          - Facebook Mobile Ads France
          - TravelBird DK
          - Skyscanner Deals Partnership
          - Google CPL France - Brand
          - Secret Escapes BE
          - Unister generic
          - Digital window
          - Facebook Mobile Ads Italy
          - Google CPL Sweden - Brand
          - Google CPL Spain - Brand
          - TravelBird DE
          - Facebook Mobile Ads Spain
          - Google CPL USA - Non-Brand EC
          - Bing Yahoo CPL non-Brand USA
          - Google CPL Germany - Non-Brand - Account 2 Hotel
          - Google CPL Denmark - Non-Brand
          - Secret Escapes DE for mobile apps
          - Facebook Ads NL Mobile & Desktop
          - Tre Kronor Display
          - Payclick IT
          - Secret Escapes ID
          - ES magazine for mobile apps
          - Google GDN Germany
          - Secret Escapes DK
          - TravelHotelCard 3V Visa SOI
          - Google CPL Belgium - Brand
          - Google CPL Germany - Non-Brand - Account 3 Holiday
          - Secret Escapes CH
          - facebook page
          - Bing Yahoo CPL Brand German
          - Leverate Native
          - Facebook Ads Sweden Mobile
          - google UK PPC CPL 4
          - Secret Escapes NO
          - Secret Escapes IE
          - SweepsJan2018
          - Google CPL brand Switzerland
          - Secret Escapes IT for mobile apps
          - Google CPA Campaign
          - GDN IT
          - Facebook Ads Netherlands
          - Facebook Ads France
          - Google CPL non-brand Austria
          - Bing Yahoo CPL non-Brand German
          - GDN UK
          - Leonardo IT
          - Travelfinder (SE)
          - DC
          - TravelBird FI
          - Outbrain DE
          - Facebook Ads Denmark Mobile
          - Secret Escapes DE for mobile wrap
          - Telegraph Travel Other
    time_dimensions:
      - name: SIGNUP_TSTAMP
        synonyms:
          - account creation date
          - join date
          - registration date
          - registration timestamp
          - signup date
          - signup timestamp
        description: |
          Timestamp when the customer first registered/signed up for their account.
        expr: SIGNUP_TSTAMP
        data_type: TIMESTAMP_NTZ(9)
        sample_values:
          - 2016-07-08T20:21:41.000+0000
          - 2018-10-03T13:19:36.000+0000
          - 2025-04-14T18:24:50.000+0000
    facts:
      - name: SHIRO_USER_ID
        synonyms:
          - account id
          - customer id
          - member id
          - user id
        description: |
          Unique customer identifier. Primary key linking to booking transactions via FACT_BOOKING.SHIRO_USER_ID.
        expr: SHIRO_USER_ID
        data_type: NUMBER(38,0)
        access_modifier: public_access
        sample_values:
          - '35343862'
          - '39445427'
          - '30470101'
    filters:
      - name: ACTIVE_ACCOUNTS
        synonyms:
          - active customers
          - active members
          - active user accounts
          - active users
          - users with an active account
        description: |
          Filter expression to select only active user accounts with FULL_ACCOUNT status.  Excludes deleted, blocked, deactivated, and unsubscribed accounts.
        expr: MEMBERSHIP_ACCOUNT_STATUS = 'FULL_ACCOUNT'
    primary_key:
      columns:
        - SHIRO_USER_ID
relationships:
  - name: BOOKING_TO_SALE
    left_table: FACT_BOOKING
    right_table: DIM_SALE
    relationship_columns:
      - left_column: SE_SALE_ID
        right_column: SE_SALE_ID
    relationship_type: many_to_one
  - name: BOOKING_TO_SE_CALENDAR
    left_table: FACT_BOOKING
    right_table: SE_CALENDAR
    relationship_columns:
      - left_column: BOOKING_COMPLETED_DATE
        right_column: DATE_VALUE
    relationship_type: many_to_one
  - name: BOOKING_TO_USER
    left_table: FACT_BOOKING
    right_table: SE_USER_ATTRIBUTES
    relationship_columns:
      - left_column: SHIRO_USER_ID
        right_column: SHIRO_USER_ID
    relationship_type: many_to_one
verified_queries:
  - name: '"show me live bookings to destination Germany yesterday"'
    sql: |-
      SELECT
        fb.booking_id,
        fb.booking_completed_date,
        fb.shiro_user_id,
        fb.gross_revenue_gbp_constant_currency,
        fb.margin_gross_of_toms_gbp_constant_currency
      FROM
        fact_booking AS fb
        INNER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id
      WHERE
        fb.booking_status_type = 'live'
        AND ds.posu_country = 'Germany'
        AND fb.se_brand = 'SE Brand'
        AND fb.booking_completed_date = CURRENT_DATE - INTERVAL '1 DAY'
      ORDER BY
        fb.booking_completed_date DESC NULLS LAST
    question: Show me live bookings to destination Germany yesterday
    verified_at: 1763727031
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"Show me live bookings for se brand per month for 2025"'
    sql: |-
      SELECT
        DATE_TRUNC('MONTH', fb.booking_completed_date) AS month,
        COUNT(fb.booking_id) AS booking_count,
        SUM(fb.margin_gross_of_toms_gbp_constant_currency) AS total_revenue_gbp
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND DATE_PART('year', fb.booking_completed_date) = 2025
      GROUP BY
        DATE_TRUNC('MONTH', fb.booking_completed_date)
      ORDER BY
        month DESC NULLS LAST
    question: Show me live bookings for se brand per month for 2025
    verified_at: 1763727043
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"Give me a daily summary of trade for the last 7 days"'
    sql: |-
      SELECT
        fcb.booking_completed_date,
        COUNT(*) AS total_bookings,
        COUNT(DISTINCT fcb.bookers) AS unique_bookers,
        ROUND(SUM(fcb.gross_revenue_gbp_constant_currency)) AS total_gross_revenue_gbp,
        ROUND(
          SUM(fcb.margin_gross_of_toms_gbp_constant_currency)
        ) AS total_margin_gbp
      FROM
        fact_booking AS fcb
      WHERE
        fcb.se_brand = 'SE Brand'
        AND fcb.booking_status_type = 'live'
        AND fcb.booking_completed_date >= DATEADD(DAY, -8, CURRENT_DATE)
        AND fcb.booking_completed_date < CURRENT_DATE
      GROUP BY
        fcb.booking_completed_date
      ORDER BY
        fcb.booking_completed_date DESC NULLS LAST
    question: Give me a daily summary of trade for the last 7 days
    verified_at: 1767967316
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"create some buckets of 1, 2, 3 - 5, and 6+ bookers and show me how many people are in each bucket for bookings this year"'
    sql: |-
      WITH booking_buckets AS (
        SELECT
          shiro_user_id,
          CASE
            WHEN live_booking_index = 1 THEN '1'
            WHEN live_booking_index = 2 THEN '2'
            WHEN live_booking_index BETWEEN 3
            AND 5 THEN '3-5'
            WHEN live_booking_index >= 6 THEN '6+'
          END AS booking_bucket
        FROM
          fact_booking
        WHERE
          se_brand = 'SE Brand'
          AND booking_status_type = 'live'
          AND DATE_PART('YEAR', booking_completed_date) = 2025
      )
      SELECT
        booking_bucket,
        COUNT(DISTINCT shiro_user_id) AS bookers_count
      FROM
        booking_buckets
      WHERE
        NOT booking_bucket IS NULL
      GROUP BY
        booking_bucket
      ORDER BY
        CASE
          booking_bucket
          WHEN '1' THEN 1
          WHEN '2' THEN 2
          WHEN '3-5' THEN 3
          WHEN '6+' THEN 4
        END
    question: create some buckets of 1, 2, 3 - 5, and 6+ bookers and show me how many people are in each bucket for bookings this year
    verified_at: 1763727563
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"How has trade to iceland the destination changed over the last 24 months"'
    sql: |-
      WITH monthly_iceland_bookings AS (
        SELECT
          DATE_TRUNC('MONTH', fb.booking_completed_date) AS month,
          COUNT(fb.booking_id) AS booking_count,
          ROUND(
            SUM(fb.margin_gross_of_toms_gbp_constant_currency)
          ) AS total_revenue_gbp
        FROM
          fact_booking AS fb
          LEFT OUTER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id
        WHERE
          fb.booking_status_type = 'live'
          AND fb.se_brand = 'SE Brand'
          AND ds.posu_country = 'Iceland'
          AND fb.booking_completed_date >= '2023-11-01'
          AND fb.booking_completed_date < '2025-12-01'
        GROUP BY
          DATE_TRUNC('MONTH', fb.booking_completed_date)
      ),
      mom_changes AS (
        SELECT
          curr.month AS curr_month,
          prev.month AS prev_month,
          curr.booking_count AS curr_booking_count,
          prev.booking_count AS prev_booking_count,
          curr.total_revenue_gbp AS curr_revenue_gbp,
          prev.total_revenue_gbp AS prev_revenue_gbp,
          curr.booking_count - prev.booking_count AS booking_count_change,
          CASE
            WHEN prev.booking_count <> 0 THEN ROUND(
              (curr.booking_count - prev.booking_count) / NULLIF(prev.booking_count, 0) * 100,
              2
            )
          END AS booking_count_pct_change,
          curr.total_revenue_gbp - prev.total_revenue_gbp AS revenue_change,
          CASE
            WHEN prev.total_revenue_gbp <> 0 THEN ROUND(
              (curr.total_revenue_gbp - prev.total_revenue_gbp) / NULLIF(prev.total_revenue_gbp, 0) * 100,
              2
            )
          END AS revenue_pct_change
        FROM
          monthly_iceland_bookings AS curr
          LEFT JOIN monthly_iceland_bookings AS prev ON curr.month = prev.month + INTERVAL '1 MONTH'
      )
      SELECT
        curr_month,
        curr_booking_count,
        curr_revenue_gbp,
        booking_count_change,
        booking_count_pct_change,
        revenue_change,
        revenue_pct_change
      FROM
        mom_changes
      ORDER BY
        curr_month DESC NULLS LAST
    question: How has trade to iceland the destination changed over the last 24 months
    verified_at: 1763728489
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"what is our cancellation rate this year"'
    sql: |-
      SELECT
        (
          COUNT_IF(fb.booking_status_type = 'cancelled') / NULLIF(
            NULLIF(
              COUNT_IF(fb.booking_status_type IN ('live', 'cancelled')),
              0
            ),
            0
          )
        ) * 100 AS cancellation_rate_percent
      FROM
        fact_booking AS fb
        LEFT OUTER JOIN se_calendar AS sc ON fb.booking_completed_date = sc.date_value
      WHERE
        fb.se_brand = 'SE Brand'
        AND sc.se_year = 2026
    question: what is our cancellation rate this year
    verified_at: 1767871045
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"how many bookings have we made this year"'
    sql: |-
      SELECT
        COUNT(fb.booking_id) AS booking_count
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND DATE_PART('year', fb.booking_completed_date) = 2026
        AND fb.booking_completed_date < CURRENT_DATE
    question: how many bookings have we made this year
    verified_at: 1767967288
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"show me bookings this year by groups of people, use adults, children and infants"'
    sql: |-
      SELECT
        fb.adult_guests,
        fb.child_guests,
        fb.infant_guests,
        COUNT(fb.booking_id) AS booking_count
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND DATE_PART('year', fb.booking_completed_date) = 2026
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        fb.adult_guests,
        fb.child_guests,
        fb.infant_guests
      ORDER BY
        booking_count DESC NULLS LAST
    question: show me bookings this year by groups of people, use adults, children and infants
    verified_at: 1767967691
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"split me bookings this year by currency"'
    sql: |-
      SELECT
        fb.currency,
        COUNT(fb.booking_id) AS booking_count
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND DATE_PART('year', fb.booking_completed_date) = 2026
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        fb.currency
      ORDER BY
        booking_count DESC NULLS LAST
    question: split me bookings this year by currency
    verified_at: 1767967718
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"what is the average lead times in days for the last 6 weeks by week"'
    sql: |-
      WITH weekly_data AS (
        SELECT
          cal.se_week,
          cal.se_year,
          AVG(fcb.booking_lead_time_days) AS avg_lead_time_days
        FROM
          fact_booking AS fcb
          LEFT OUTER JOIN se_calendar AS cal ON fcb.booking_completed_date = cal.date_value
        WHERE
          fcb.se_brand = 'SE Brand'
          AND fcb.booking_status_type = 'live'
          AND fcb.booking_completed_date >= DATE_TRUNC('WEEK', CURRENT_DATE - INTERVAL '6 WEEKS')
          AND fcb.booking_completed_date < DATE_TRUNC('WEEK', CURRENT_DATE)
        GROUP BY
          cal.se_week,
          cal.se_year
      )
      SELECT
        se_week,
        se_year,
        ROUND(avg_lead_time_days, 2) AS avg_lead_time_days
      FROM
        weekly_data
      ORDER BY
        se_year DESC,
        se_week DESC NULLS LAST
    question: what is the average lead times in days for the last 6 weeks by week
    verified_at: 1767967773
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"show me a count of bookings by all booking status types this year"'
    sql: |-
      SELECT
        fb.booking_status_type,
        COUNT(fb.booking_id) AS booking_count
      FROM
        fact_booking AS fb
      WHERE
        fb.se_brand = 'SE Brand'
        AND DATE_PART('year', fb.booking_completed_date) = 2026
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        fb.booking_status_type
      ORDER BY
        booking_count DESC NULLS LAST
    question: show me a count of bookings by all booking status types this year
    verified_at: 1767967842
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"show me bookings for 2025 by whether the bookings were international or domestic"'
    sql: |-
      SELECT
        fb.travel_type,
        COUNT(fb.booking_id) AS booking_count
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND DATE_PART('year', fb.booking_completed_date) = 2025
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        fb.travel_type
      ORDER BY
        booking_count DESC NULLS LAST
    question: show me bookings for 2025 by whether the bookings were international or domestic
    verified_at: 1767967997
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"what was the average number of rooms per booking by month for the last 12 months"'
    sql: |-
      SELECT
        DATE_TRUNC('MONTH', fb.booking_completed_date) AS booking_month,
        AVG(fb.rooms) AS avg_rooms_per_booking
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND fb.booking_completed_date >= DATE_TRUNC('MONTH', DATEADD(MONTH, -12, CURRENT_DATE))
        AND fb.booking_completed_date < DATE_TRUNC('MONTH', CURRENT_DATE)
      GROUP BY
        DATE_TRUNC('MONTH', fb.booking_completed_date)
      ORDER BY
        booking_month DESC NULLS LAST
    question: what was the average number of rooms per booking by month for the last 12 months
    verified_at: 1767968062
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"for this year show me a split of 1st, 2nd and repeat bookers"'
    sql: |-
      WITH booking_buckets AS (
        SELECT
          shiro_user_id,
          CASE
            WHEN live_booking_index = 1 THEN '1st'
            WHEN live_booking_index = 2 THEN '2nd'
            WHEN live_booking_index >= 3 THEN 'Repeat (3+)'
          END AS booking_bucket
        FROM
          fact_booking
        WHERE
          se_brand = 'SE Brand'
          AND booking_status_type = 'live'
          AND DATE_PART('YEAR', booking_completed_date) = 2026
          AND booking_completed_date < CURRENT_DATE
      )
      SELECT
        booking_bucket,
        COUNT(DISTINCT shiro_user_id) AS bookers_count
      FROM
        booking_buckets
      WHERE
        NOT booking_bucket IS NULL
      GROUP BY
        booking_bucket
      ORDER BY
        CASE
          booking_bucket
          WHEN '1st' THEN 1
          WHEN '2nd' THEN 2
          WHEN 'Repeat (3+)' THEN 3
        END
    question: for this year show me a split of 1st, 2nd and repeat bookers
    verified_at: 1767968270
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"for this year show me a split of 1st, 2nd and repeat bookings"'
    sql: |-
      WITH booking_buckets AS (
        SELECT
          booking_id,
          CASE
            WHEN live_booking_index = 1 THEN '1st'
            WHEN live_booking_index = 2 THEN '2nd'
            WHEN live_booking_index >= 3 THEN 'Repeat (3+)'
          END AS booking_bucket
        FROM
          fact_booking
        WHERE
          se_brand = 'SE Brand'
          AND booking_status_type = 'live'
          AND DATE_PART('YEAR', booking_completed_date) = 2026
          AND booking_completed_date < CURRENT_DATE
      )
      SELECT
        booking_bucket,
        COUNT(booking_id) AS booking_count
      FROM
        booking_buckets
      WHERE
        NOT booking_bucket IS NULL
      GROUP BY
        booking_bucket
      ORDER BY
        CASE
          booking_bucket
          WHEN '1st' THEN 1
          WHEN '2nd' THEN 2
          WHEN 'Repeat (3+)' THEN 3
        END
    question: for this year show me a split of 1st, 2nd and repeat bookings
    verified_at: 1767968258
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"What are the top 5 countries by gross revenue this year?"'
    sql: |-
      SELECT
        ds.posu_country,
        ROUND(SUM(fb.gross_revenue_gbp_constant_currency)) AS gross_revenue
      FROM
        fact_booking AS fb
        LEFT OUTER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id
      WHERE
        fb.se_brand = 'SE Brand'
        AND fb.booking_status_type = 'live'
        AND DATE_PART('YEAR', fb.booking_completed_date) = 2026
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        ds.posu_country
      ORDER BY
        gross_revenue DESC NULLS LAST
      LIMIT
        5
    question: What are the top 5 countries by gross revenue this year?
    verified_at: 1767968453
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"Show me the total margin gross for each product type this year."'
    sql: |-
      SELECT
        ds.product_configuration,
        ROUND(
          SUM(fb.margin_gross_of_toms_gbp_constant_currency)
        ) AS total_margin_gross
      FROM
        fact_booking AS fb
        LEFT OUTER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id
      WHERE
        fb.se_brand = 'SE Brand'
        AND fb.booking_status_type = 'live'
        AND DATE_PART('year', fb.booking_completed_date) = 2026
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        ds.product_configuration
      ORDER BY
        total_margin_gross DESC NULLS LAST
    question: Show me the total margin gross for each product type this year.
    verified_at: 1767968615
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"Compare monthly gross revenue for this year versus last year."'
    sql: |-
      WITH monthly_revenue_2026 AS (
        SELECT
          DATE_TRUNC('MONTH', fb.booking_completed_date) AS month,
          ROUND(SUM(fb.gross_revenue_gbp_constant_currency)) AS revenue_2026
        FROM
          fact_booking AS fb
        WHERE
          fb.se_brand = 'SE Brand'
          AND fb.booking_status_type = 'live'
          AND DATE_PART('YEAR', fb.booking_completed_date) = 2026
          AND fb.booking_completed_date < CURRENT_DATE
        GROUP BY
          DATE_TRUNC('MONTH', fb.booking_completed_date)
      ),
      monthly_revenue_2025 AS (
        SELECT
          DATE_TRUNC('MONTH', fb.booking_completed_date) AS month,
          ROUND(SUM(fb.gross_revenue_gbp_constant_currency)) AS revenue_2025
        FROM
          fact_booking AS fb
        WHERE
          fb.se_brand = 'SE Brand'
          AND fb.booking_status_type = 'live'
          AND DATE_PART('YEAR', fb.booking_completed_date) = 2025
        GROUP BY
          DATE_TRUNC('MONTH', fb.booking_completed_date)
      )
      SELECT
        curr.month AS current_month,
        prev.month AS previous_month,
        curr.revenue_2026 AS current_revenue,
        prev.revenue_2025 AS previous_revenue,
        curr.revenue_2026 - prev.revenue_2025 AS absolute_change,
        ROUND(
          (curr.revenue_2026 - prev.revenue_2025) / NULLIF(NULLIF(prev.revenue_2025, 0), 0) * 100,
          2
        ) AS percentage_change
      FROM
        monthly_revenue_2026 AS curr
        LEFT JOIN monthly_revenue_2025 AS prev ON DATE_PART('MONTH', curr.month) = DATE_PART('MONTH', prev.month)
      ORDER BY
        curr.month DESC NULLS LAST
    question: Compare monthly gross revenue for this year versus last year.
    verified_at: 1767968638
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"Which affiliate names have generated the highest gross revenue in the last 6 months?"'
    sql: |-
      SELECT
        sua.current_affiliate_name,
        ROUND(SUM(fb.gross_revenue_gbp_constant_currency)) AS gross_revenue
      FROM
        fact_booking AS fb
        LEFT OUTER JOIN se_user_attributes AS sua ON fb.shiro_user_id = sua.shiro_user_id
      WHERE
        fb.se_brand = 'SE Brand'
        AND fb.booking_status_type = 'live'
        AND fb.booking_completed_date >= DATEADD(MONTH, -6, CURRENT_DATE)
        AND fb.booking_completed_date < CURRENT_DATE
      GROUP BY
        sua.current_affiliate_name
      ORDER BY
        gross_revenue DESC NULLS LAST
      LIMIT
        5
    question: Which affiliate names have generated the highest gross revenue in the last 6 months?
    verified_at: 1767968698
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"What is the average price per night for bookings in the different POSU regions?"'
    sql: |-
      SELECT
        ds.posu_region,
        ROUND(AVG(fb.price_per_night)) AS avg_price_per_night
      FROM
        fact_booking AS fb
        LEFT OUTER JOIN dim_sale AS ds ON fb.se_sale_id = ds.se_sale_id
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND NOT ds.posu_region IS NULL
      GROUP BY
        ds.posu_region
      ORDER BY
        avg_price_per_night DESC NULLS LAST
    question: What is the average price per night for bookings in the different POSU regions?
    verified_at: 1767968788
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"What is the average booking lead time in days for international vs. domestic travel?"'
    sql: |-
      SELECT
        fb.travel_type,
        MIN(fb.booking_completed_date) AS start_date,
        MAX(fb.booking_completed_date) AS end_date,
        ROUND(AVG(fb.booking_lead_time_days), 2) AS avg_lead_time_days
      FROM
        fact_booking AS fb
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
        AND fb.travel_type IN ('International', 'Domestic')
      GROUP BY
        fb.travel_type
      ORDER BY
        avg_lead_time_days DESC NULLS LAST
    question: What is the average booking lead time in days for international vs. domestic travel?
    verified_at: 1767968995
    verified_by: robin patel
    use_as_onboarding_question: false
  - name: '"Compare the total number of bookings between users who have the app installed vs. those who don''t."""'
    sql: |-
      SELECT
        sua.has_app_installed,
        COUNT(fb.booking_id) AS booking_count,
        MIN(fb.booking_completed_date) AS start_date,
        MAX(fb.booking_completed_date) AS end_date
      FROM
        fact_booking AS fb
        LEFT OUTER JOIN se_user_attributes AS sua ON fb.shiro_user_id = sua.shiro_user_id
      WHERE
        fb.booking_status_type = 'live'
        AND fb.se_brand = 'SE Brand'
      GROUP BY
        sua.has_app_installed
      ORDER BY
        booking_count DESC NULLS LAST
    question: Compare the total number of bookings between users who have the app installed vs. those who don't.
    verified_at: 1767969333
    verified_by: robin patel
    use_as_onboarding_question: false
module_custom_instructions:
  sql_generation: |-
    # ============================================================================
    # SECTION 1: IDENTITY & SCOPE
    # ============================================================================
    - You are an expert analyst for Bookings, Revenue, Customer Behavior, and Travel Performance.
    - Primary focus: Analyzing booking patterns, revenue trends, customer segmentation, and destination performance.
    - Always use ILIKE for string comparisons to ensure case-insensitivity.
    - Never sum or aggregate ID columns (columns ending in _ID or containing 'identifier').

    # ============================================================================
    # SECTION 2: DEFAULT FILTERS (Auto-Apply Unless Overridden)
    # ============================================================================
    - **Brand Filter**: Always apply `se_brand = 'SE Brand'` unless user explicitly requests:
      - "Travelist" / "Travelist brand"
      - "all brands" / "both brands"

    - **Booking Status Filter**: Always apply `booking_status_type = 'live'` unless user explicitly requests:
      - "cancelled" / "cancellations" → use 'cancelled'
      - "abandoned" → use 'abandoned'
      - "all bookings" / "all statuses" → remove filter

    - **Test User Filter**: Always exclude test users with `is_test_user = FALSE` in SE_USER_ATTRIBUTES

    - **Date Range**: When no date range specified:
      - Default to current calendar year (YEAR(BOOKING_COMPLETED_DATE) = YEAR(CURRENT_DATE))
      - Always EXCLUDE current date: BOOKING_COMPLETED_DATE < CURRENT_DATE

    # ============================================================================
    # SECTION 3: BUSINESS VOCABULARY & TERM MAPPING
    # ============================================================================

    ## Revenue & Financial Terms
    - "Revenue" / "Sales" / "GMV" → GROSS_REVENUE_GBP_CONSTANT_CURRENCY
    - "Profit" / "Margin" → MARGIN_GROSS_OF_TOMS_GBP_CONSTANT_CURRENCY
    - "AOV" / "Average order value" / "Average booking value" → AVG(GROSS_REVENUE_GBP_CONSTANT_CURRENCY)
    - "Total bookings value" → SUM(GROSS_REVENUE_GBP_CONSTANT_CURRENCY)

    ## Booking & Transaction Terms
    - "Bookings" / "Transactions" / "Orders" / "Reservations" → COUNT(BOOKING_ID) where booking_status_type = 'live'
    - "Customers" / "Users" / "Bookers" → COUNT(DISTINCT SHIRO_USER_ID)
    - "Cancellations" → COUNT(BOOKING_ID) where booking_status_type = 'cancelled'
    - "Cancelled bookings" → records where booking_status_type = 'cancelled'

    ## Customer Segmentation Terms
    - "New customers" / "First-time bookers" → LIVE_BOOKING_INDEX = 1
    - "Repeat customers" / "Returning customers" → LIVE_BOOKING_INDEX > 1
    - "VIP customers" / "Loyal customers" → LIVE_BOOKING_INDEX > 10 OR reference BOOKER_LOYALTY_SEGMENT
    - "Churned customers" / "Inactive customers" → DAYS_SINCE_PREVIOUS_LIVE_BOOKING > 365

    ## Destination Terms
    - "Destination" → POSU_CITY (city level) or POSU_COUNTRY (country level) - choose based on context
    - "Popular destinations" → High booking count destinations (Top 10 by default)
    - "Region" → POSU_REGION for broad analysis, POSU_SUB_REGION for detailed

    ## Date & Timing Terms
    - "Booking date" / "Purchase date" / "Transaction date" → BOOKING_COMPLETED_DATE
    - "Travel date" / "Trip date" / "Holiday date" → CHECK_IN_DATE
    - "Last minute bookings" → BOOKING_LEAD_TIME_DAYS <= 7 OR BOOKING_LEAD_TIME_CATEGORY = 'Last Minute (0-7 days)'

    # ============================================================================
    # SECTION 4: METRIC CALCULATION RULES
    # ============================================================================

    ## Conversion & Rate Calculations
    - **Always use NULLIF for ratios**: (numerator / NULLIF(denominator, 0))
    - **Cancellation Rate**: COUNT_IF(booking_status_type = 'cancelled') / NULLIF(COUNT_IF(booking_status_type IN ('live', 'cancelled')), 0)
      - EXCLUDE 'abandoned' and 'other' from denominator
    - **Repeat Rate**: COUNT_IF(LIVE_BOOKING_INDEX > 1) / NULLIF(COUNT(DISTINCT SHIRO_USER_ID), 0)
    - **Domestic vs International Split**: COUNT(*) grouped by TRAVEL_TYPE

    ## Customer Lifetime Calculations
    - **Customer Lifetime Value (CLV)**: SUM(GROSS_REVENUE_GBP_CONSTANT_CURRENCY) grouped by SHIRO_USER_ID
    - **Customer Lifetime Bookings**: MAX(LIVE_BOOKING_INDEX) grouped by SHIRO_USER_ID
    - **Average Days Between Bookings**: AVG(DAYS_SINCE_PREVIOUS_LIVE_BOOKING) excluding NULL (first bookings)

    ## Financial Calculations
    - **Round all financial values**: Use ROUND(value, 0) for currency in GBP
    - **Margin %**: (MARGIN / NULLIF(REVENUE, 0)) * 100
    - **Revenue per Night**: GROSS_REVENUE_GBP_CONSTANT_CURRENCY / NULLIF(NO_NIGHTS, 0)

    # ============================================================================
    # SECTION 5: DATE & TIME HANDLING
    # ============================================================================

    ## Default Date Column Selection
    - **Booking analysis** (when did bookings occur?) → BOOKING_COMPLETED_DATE
    - **Travel analysis** (when are people traveling?) → CHECK_IN_DATE
    - **Cancellation analysis** → CANCELLATION_DATE
    - **User acquisition analysis** → SIGNUP_TSTAMP from SE_USER_ATTRIBUTES
    - **If ambiguous, default to BOOKING_COMPLETED_DATE**

    ## Time Period Defaults
    - "Yesterday" → BOOKING_COMPLETED_DATE = CURRENT_DATE - 1
    - "Last week" → Previous complete calendar week (Mon-Sun)
    - "Last month" → Previous complete calendar month
    - "This year" / "YTD" → YEAR(BOOKING_COMPLETED_DATE) = YEAR(CURRENT_DATE) AND BOOKING_COMPLETED_DATE < CURRENT_DATE
    - "Last 7 days" → BOOKING_COMPLETED_DATE >= CURRENT_DATE - 7 AND BOOKING_COMPLETED_DATE < CURRENT_DATE
    - "Last 30 days" → BOOKING_COMPLETED_DATE >= CURRENT_DATE - 30 AND BOOKING_COMPLETED_DATE < CURRENT_DATE

    ## Time Granularity Selection (Auto-choose appropriate grouping)
    - Date range <= 31 days → Group by DAY (DATE_TRUNC('DAY', BOOKING_COMPLETED_DATE))
    - Date range 32-180 days → Group by WEEK (use SE_WEEK, SE_YEAR from SE_CALENDAR)
    - Date range 181-730 days → Group by MONTH (DATE_TRUNC('MONTH', BOOKING_COMPLETED_DATE))
    - Date range > 730 days → Group by QUARTER or YEAR

    ## Always Exclude Incomplete Periods
    - Current day: BOOKING_COMPLETED_DATE < CURRENT_DATE
    - Current week (if grouping by week): SE_WEEK < current week
    - Current month (if grouping by month): DATE_TRUNC('MONTH', date) < DATE_TRUNC('MONTH', CURRENT_DATE)

    # ============================================================================
    # SECTION 6: RANKING & TOP N QUERIES
    # ============================================================================
    - "Top destinations" → Top 5 by booking count unless otherwise specified
    - "Best performing" → Top 10 by revenue unless context suggests different metric
    - "Top customers" → Top 10 by lifetime revenue (CLV)
    - "Popular products" → Top 10 by booking volume
    - Always include ranking number: ROW_NUMBER() OVER (ORDER BY metric DESC)
    - Default to Top 5 for any "top X" query unless user specifies different number
    - Always use ORDER BY ... DESC NULLS LAST

    # ============================================================================
    # SECTION 7: RESULT PRESENTATION & FORMATTING
    # ============================================================================

    ## Numeric Formatting
    - **Currency (GBP)**: Round to integers, no decimal places: ROUND(value, 0)
    - **Percentages**: Multiply by 100, show 2 decimal places: ROUND(value * 100, 2)
    - **Counts**: Always integers (booking counts, customer counts)
    - **Averages**: Round to 1 decimal for money, 0 decimals for days/nights

    ## Column Naming
    - Use clear, business-friendly aliases
    - Examples: 
      - BOOKING_COMPLETED_DATE AS booking_date
      - COUNT(DISTINCT SHIRO_USER_ID) AS total_customers
      - SUM(GROSS_REVENUE_GBP_CONSTANT_CURRENCY) AS total_revenue_gbp

    ## Row Limits
    - Limit raw data queries to 100 rows unless "all" is requested
    - No limit on aggregated results (summaries, groupings)
    - For large result sets, suggest using filters to narrow results

    # ============================================================================
    # SECTION 8: COMMON ANALYSIS PATTERNS
    # ============================================================================

    ## Year-over-Year Comparisons
    - Use same calendar period from previous year
    - Example: Jan 2026 vs Jan 2025
    - Include absolute change and percentage change
    - Format: current_value, previous_value, absolute_change, pct_change

    ## Cohort Analysis
    - Group customers by SIGNUP_TSTAMP year/month
    - Track behavior over time using LIVE_BOOKING_INDEX
    - Common cohorts: signup month, first booking month

    ## Segmentation Defaults
    - **Customer segments**: Use BOOKER_LOYALTY_SEGMENT when analyzing by booking frequency
    - **Booking behavior**: Use BOOKER_RECENCY_SEGMENT when analyzing engagement
    - **Travel patterns**: Use LENGTH_OF_STAY_CATEGORY for trip duration analysis
    - **Price sensitivity**: Use PRICE_PER_NIGHT_CATEGORY for spend analysis

    ## Performance Metrics Priority Order
    When user asks "how are we performing?" show in this order:
    1. Total bookings (count)
    2. Total revenue (GBP)
    3. Average booking value
    4. Unique customers
    5. Cancellation rate

    # ============================================================================
    # SECTION 9: EDGE CASES & ERROR HANDLING
    # ============================================================================

    ## Data Quality Rules
    - Exclude bookings with NO_NIGHTS <= 0 (invalid stays)
    - Exclude bookings with BOOKING_LEAD_TIME_DAYS < 0 (data errors)
    - Exclude records where ADULT_GUESTS = 0 (invalid bookings)
    - For price analysis, exclude GROSS_REVENUE_GBP_CONSTANT_CURRENCY <= 0

    ## Missing Data Handling
    - DAYS_SINCE_PREVIOUS_LIVE_BOOKING is NULL → First-time booker
    - CANCELLATION_DATE is NULL → Booking not cancelled
    - SE_SALE_ID is NULL → May occur for some booking types, don't exclude unless analyzing sale attributes

    ## Ambiguous Requests
    - "Bookings by region" → Assume POSU_REGION (destination) unless context suggests customer territory
    - "Revenue" without time period → Current year-to-date
    - "Customers" → Active customers with FULL_ACCOUNT status
    - "Conversion" → Not applicable to booking data (use for session analysis instead)

    # ============================================================================
    # SECTION 10: MULTI-TABLE QUERY GUIDANCE
    # ============================================================================

    ## When to Join Tables
    - **FACT_BOOKING + DIM_SALE**: When analyzing destination attributes, product types, sale status
    - **FACT_BOOKING + SE_USER_ATTRIBUTES**: When analyzing user acquisition, marketing channels, communication preferences
    - **FACT_BOOKING + SE_CALENDAR**: When needing week numbers (SE_WEEK, SE_YEAR) for weekly aggregation

    ## Join Keys
    - FACT_BOOKING.SE_SALE_ID = DIM_SALE.SE_SALE_ID
    - FACT_BOOKING.SHIRO_USER_ID = SE_USER_ATTRIBUTES.SHIRO_USER_ID
    - FACT_BOOKING.BOOKING_COMPLETED_DATE = SE_CALENDAR.DATE_VALUE (or CHECK_IN_DATE)

    # ============================================================================
    # SECTION 11: SPECIFIC USE CASES
    # ============================================================================

    ## "Show me new vs repeat customer revenue"
    - Group by: CASE WHEN LIVE_BOOKING_INDEX = 1 THEN 'New' ELSE 'Repeat' END
    - Metrics: COUNT(BOOKING_ID), SUM(REVENUE), COUNT(DISTINCT SHIRO_USER_ID)

    ## "What's our most popular destination?"
    - Metric: COUNT(BOOKING_ID) 
    - Group by: POSU_CITY (or POSU_COUNTRY for broader view)
    - Order by: booking count DESC
    - Limit: 1 (or Top 5 for context)

    ## "Average booking value by device"
    - Group by: DEVICE_PLATFORM
    - Metric: AVG(GROSS_REVENUE_GBP_CONSTANT_CURRENCY)
    - Round to 0 decimal places

    ## "Cancellation rate trend"
    - Use: BOOKING_COMPLETED_DATE for time dimension
    - Calculate: cancellation rate per time period
    - Include: booking counts for context